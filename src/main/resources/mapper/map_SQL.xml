<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ce.smell.mapper.MapMapper">

	<update id="putFlag" parameterType="java.util.HashMap">
		UPDATE ANALS_AREA_MANAGE SET GRID_INTRST_SE_CODE = #{flag} WHERE ANALS_AREA_ID = #{indexId}
	</update>
	
	<insert id="insertAnals" parameterType="java.util.HashMap">
		INSERT INTO ANALS_AREA_MANAGE
		 (ANALS_AREA_ID, GRID_INTRST_SE_CODE ,INTRST_AREA_NM,INTRST_AREA_LC,TPGRPH_AL,REGIST_DT,REGISTER_ID,CHANGE_DT,CHANGER_ID,PREDICT_AL,UTMX,UTMY,GRID_AREA_ID)
		 SELECT (SELECT  MAX(CAST(ANALS_AREA_ID AS INT))+1 AS MAX_AREA_ID 
		   FROM ANALS_AREA_MANAGE ),'ANL01002' ,INTRST_AREA_NM,INTRST_AREA_LC,TPGRPH_AL,REGIST_DT,REGISTER_ID,CHANGE_DT,CHANGER_ID,'${predictAl}',UTMX,UTMY,GRID_AREA_ID
		 FROM ANALS_AREA_MANAGE
		 WHERE GRID_INTRST_SE_CODE = 'ANL01001'
		 AND GRID_AREA_ID = #{indexId}
	</insert>
	<update id="updateAnals" parameterType="java.util.HashMap">
		UPDATE ANALS_AREA_MANAGE SET PREDICT_AL = #{predictAl} WHERE GRID_INTRST_SE_CODE = 'ANL01001' AND GRID_AREA_ID = #{indexId}
	</update>
	
	<delete id="deleteAnals" parameterType="java.util.HashMap">
		DELETE FROM ANALS_AREA_MANAGE
	      WHERE GRID_INTRST_SE_CODE = 'ANL01002' 
		  AND GRID_AREA_ID = #{indexId}
	</delete>
	
	<select id="complaintStatusFeature" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT CVPL_NO,
			   LO AS POINT_X,
			   LA AS POINT_Y,
			   CVPL_TY_CODE,
			   CVPL_LC
  		  FROM CVPL_MANAGE
  		 WHERE LA IS NOT NULL
           AND LO IS NOT NULL
  		  <if test="flag != 1">
	  		   AND DATE_FORMAT(CVPL_DT,'%Y%m%d') <![CDATA[>=]]> #{startDate}
	     	   AND DATE_FORMAT(CVPL_DT,'%Y%m%d') <![CDATA[<=]]> #{endDate}
	     	   <if test="branchName != ''">
	    			AND CVPL_CN LIKE CONCAT('%', #{branchName}, '%')
	  			</if>
	  			AND CVPL_TY_CODE IN
	  			<foreach collection="checkBox" item="type" index="index" open="(" separator="," close=")">
					#{type}
	  			</foreach>	
	     	   AND LEGALDONG_CODE LIKE CONCAT('%', #{town}, '%')
     	   </if>
	</select>
	
	<select id="complaintStatusGrid" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT CVPL_NO,
	           DATE_FORMAT(CVPL_DT,'%Y-%m-%d %H:%i') AS CVPL_DT,
			   CPTTR,
			   CPTTR_CTTPC,
			   CVPL_LC,
			   CVPL_CN,
			   DATE_FORMAT(REGIST_DT,'%Y-%m-%d %H:%i') AS REGIST_DT,
			   REGISTER_ID,
               DATE_FORMAT(CHANGE_DT,'%Y-%m-%d %H:%i') AS CHANGE_DT,
			   CHANGER_ID
  		  FROM CVPL_MANAGE
  		  <if test="flag == 1">
  		   	WHERE CVPL_NO IN (${code})
  		  </if>
  		  <if test="flag != 1">
	  		 WHERE DATE_FORMAT(CVPL_DT,'%Y%m%d') <![CDATA[>=]]> #{startDate}
	     	   AND DATE_FORMAT(CVPL_DT,'%Y%m%d') <![CDATA[<=]]> #{endDate}
	     	   AND LA IS NOT NULL
	     	   <if test="branchName != ''">
	    			AND CVPL_CN LIKE CONCAT('%', #{branchName}, '%')
	  			</if>
	  			AND CVPL_TY_CODE IN
	  			<foreach collection="checkBox" item="type" index="index" open="(" separator="," close=")">
					#{type}
	  			</foreach>	
	     	   AND LEGALDONG_CODE LIKE CONCAT('%', #{town}, '%')
     	   </if>
	</select>
	
	<select id="complaintStatusClick" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT DATE_FORMAT(CVPL_DT,'%Y-%m-%d %H:%i') AS CVPL_DT,
			   LO AS POINT_X,
			   LA AS POINT_Y,
			   CVPL_LC,
			   CVPL_CN
  		  FROM CVPL_MANAGE
  		 WHERE CVPL_NO = #{CVPL_NO}
	</select>
	
	<select id="portableMeasurementGrid" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	  SELECT CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE) AS CODE,
			   B.OPR_STTUS_CODE,
	   		   DATE_FORMAT(MESURE_DT,'%Y-%m-%d %H:%i') AS MESURE_DT,
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0001' THEN MESURE_DNSTY END),3) AS 'OU',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0002' THEN MESURE_DNSTY END),3) AS 'H2S',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0004' THEN MESURE_DNSTY END),3) AS 'VOCS',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0005' THEN MESURE_DNSTY END),3) AS 'ETHANOL',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0006' THEN MESURE_DNSTY END),3) AS 'TMA',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0007' THEN MESURE_DNSTY END),3) AS 'CH3SH',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0008' THEN MESURE_DNSTY END),3) AS 'CFC',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0009' THEN MESURE_DNSTY END),3) AS 'PM2_5',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0010' THEN MESURE_DNSTY END),3) AS 'PM10',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0011' THEN MESURE_DNSTY END),3) AS 'SO2',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0012' THEN MESURE_DNSTY END),3) AS 'NO2'
  		  FROM IOT_SENSOR_MESURE_INFO A,
	   		   IOT_SENSOR_SPCS_INFO B,
	     	   IOT_MESURE_IEM_MANAGE C
 		 WHERE A.SPOT_CODE IN (#{radio})
   		   AND CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE,A.SENSOR_SPCS_NO) = CONCAT(B.LEGALDONG_CODE,B.SPOT_CODE,B.SENSOR_SPCS_NO)
   		   AND C.IEM_CODE = B.IEM_CODE
   		   AND A.LEGALDONG_CODE LIKE CONCAT('%', #{town}, '%')
   		    AND DATE_FORMAT(MESURE_DT,'%Y%m%d%H') <![CDATA[>=]]> CONCAT(#{startDate},#{startTime})
     	   AND DATE_FORMAT(MESURE_DT,'%Y%m%d%H') <![CDATA[<=]]> CONCAT(#{endDate},#{endTime})
	  GROUP BY OPR_STTUS_CODE,MESURE_DT
	</select>
	
	<select id="portableMeasurementFeature" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	    SELECT CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE) AS CODE,
	   		   DATE_FORMAT(MESURE_DT,'%m/%d %H:%i') AS LABEL,
	   		   DATE_FORMAT(MESURE_DT,'%Y-%m-%d %H:%i') AS MESURE_DT,
               B.LA AS POINT_Y,
               B.LO AS POINT_X,
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0001' THEN MESURE_DNSTY END),3) AS 'OU',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0002' THEN MESURE_DNSTY END),3) AS 'H2S',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0004' THEN MESURE_DNSTY END),3) AS 'VOCS',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0005' THEN MESURE_DNSTY END),3) AS 'ETHANOL',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0006' THEN MESURE_DNSTY END),3) AS 'TMA',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0007' THEN MESURE_DNSTY END),3) AS 'CH3SH',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0008' THEN MESURE_DNSTY END),3) AS 'CFC',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0009' THEN MESURE_DNSTY END),3) AS 'PM2_5',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0010' THEN MESURE_DNSTY END),3) AS 'PM10',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0011' THEN MESURE_DNSTY END),3) AS 'SO2',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0012' THEN MESURE_DNSTY END),3) AS 'NO2',
			   DATE_FORMAT(MESURE_DT,'%Y%m%d%H%i') AS DATE
  		  FROM IOT_SENSOR_MESURE_INFO A,
			   IOT_SENSOR_MVMN_INFO B
		 WHERE CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE) = CONCAT(B.LEGALDONG_CODE,B.SPOT_CODE)
           AND DTA_DT = MESURE_DT
 		   AND A.SPOT_CODE IN (#{radio})
 		   AND A.LEGALDONG_CODE LIKE CONCAT('%', #{town}, '%')
 		   AND DATE_FORMAT(A.MESURE_DT,'%Y%m%d%H') <![CDATA[>=]]> CONCAT(#{startDate},#{startTime})
     	   AND DATE_FORMAT(A.MESURE_DT,'%Y%m%d%H') <![CDATA[<=]]> CONCAT(#{endDate},#{endTime})
	  GROUP BY CODE,LABEL,MESURE_DT,DATE,B.LA,B.LO
	</select>
	
	<select id="fixedMeasurementGrid" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE) AS CODE,
			   B.SENSOR_NM,
               OPR_STTUS_CODE,
			   DATE_FORMAT(MESURE_DT,'%Y%m%d%H%i') AS DATE,
			   DATE_FORMAT(MESURE_DT,'%Y-%m-%d %H:%i') AS MESURE_DT,
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0001' THEN MESURE_DNSTY END),3) AS 'OU',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0002' THEN MESURE_DNSTY END),3) AS 'H2S',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0004' THEN MESURE_DNSTY END),3) AS 'VOCS',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0005' THEN MESURE_DNSTY END),3) AS 'ETHANOL',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0006' THEN MESURE_DNSTY END),3) AS 'TMA',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0007' THEN MESURE_DNSTY END),3) AS 'CH3SH',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0008' THEN MESURE_DNSTY END),3) AS 'CFC',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0009' THEN MESURE_DNSTY END),3) AS 'PM2_5',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0010' THEN MESURE_DNSTY END),3) AS 'PM10',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0011' THEN MESURE_DNSTY END),3) AS 'SO2',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0012' THEN MESURE_DNSTY END),3) AS 'NO2'
  		  FROM bdsm.IOT_SENSOR_MESURE_INFO A,
	   		   bdsm.IOT_SENSOR_INFO B
		 WHERE  SENSOR_TY_CODE = 'SEN01001'
  		   AND CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE) = CONCAT(B.LEGALDONG_CODE,B.SPOT_CODE)
  		   AND A.LEGALDONG_CODE LIKE CONCAT(#{town}, '%')
   		   AND DATE_FORMAT(MESURE_DT,'%Y%m%d%H%i') = CONCAT(#{startDate},#{startTime},#{startMinute})
   		   AND A.SPOT_CODE NOT IN ('0003')
     	    <if test="branchName != ''">
    			AND B.SENSOR_NM LIKE CONCAT('%', #{branchName}, '%')
  			</if>
  	  GROUP BY CODE,B.SENSOR_NM,OPR_STTUS_CODE,DATE,MESURE_DT
	</select>
	<select id="chartFeature" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		  SELECT CONCAT(AA.LEGALDONG_CODE,AA.SPOT_CODE) AS CODE,
                        SENSOR_NM,
                        SENSOR_TY_CODE,
                        LO,
                        LA,
					IFNULL(
                   (SELECT MESURE_DNSTY
				  FROM IOT_SENSOR_MESURE_INFO A
				 WHERE DATE_FORMAT(MESURE_DT,'%Y%m%d%H%i') = (SELECT DATE_FORMAT(MAX(MESURE_DT),'%Y%m%d%H%i') 
																FROM IOT_SENSOR_MESURE_INFO 
															   WHERE DATE_FORMAT(MESURE_DT,'%Y%m%d%H') = DATE_FORMAT(SYSDATE(),'%Y%m%d%H'))
                   AND CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE) = CONCAT(AA.LEGALDONG_CODE,AA.SPOT_CODE)
                   AND IEM_CODE= 'S0001'),'-') AS MESURE_DNSTY
				   FROM bdsm.IOT_SENSOR_INFO AA
				  WHERE SENSOR_TY_CODE NOT IN ('SEN01004','SEN01002')
					AND LO IS NOT NULL 
					AND LA IS NOT NULL
	</select>
	<select id="fixedMeasurementFeature" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	 SELECT CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE) AS CODE,
                OPR_STTUS_CODE,
                SENSOR_NM,
                A.LA AS POINT_Y,
                A.LO AS POINT_X,
                MESURE_DT,
                DATE,
                OU,
			   H2S,
			   VOCS,
			   ETHANOL,
			   TMA,
			   CH3SH,
			   CFC,
			   PM2_5,
			   PM10,
			   SO2,
			   NO2
           FROM (SELECT * 
				   FROM bdsm.IOT_SENSOR_INFO
		          WHERE SENSOR_TY_CODE = 'SEN01001'
                    AND SPOT_CODE NOT IN ('0003')
                    AND LO IS NOT NULL
                   	AND LEGALDONG_CODE LIKE CONCAT(#{town},'%')
                    <if test="branchName != ''">
    					AND SENSOR_NM LIKE CONCAT('%', #{branchName}, '%')
  					</if>
  					) AS A
LEFT OUTER JOIN (SELECT A.SPOT_CODE,
						A.LEGALDONG_CODE,DATE_FORMAT(MESURE_DT,'%Y%m%d%H%i') AS DATE,
			   DATE_FORMAT(MESURE_DT,'%Y년 %m월 %d일 %H시 %i분') AS MESURE_DT,
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0001' THEN MESURE_DNSTY END),3) AS 'OU',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0002' THEN MESURE_DNSTY END),3) AS 'H2S',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0004' THEN MESURE_DNSTY END),3) AS 'VOCS',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0005' THEN MESURE_DNSTY END),3) AS 'ETHANOL',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0006' THEN MESURE_DNSTY END),3) AS 'TMA',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0007' THEN MESURE_DNSTY END),3) AS 'CH3SH',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0008' THEN MESURE_DNSTY END),3) AS 'CFC',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0009' THEN MESURE_DNSTY END),3) AS 'PM2_5',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0010' THEN MESURE_DNSTY END),3) AS 'PM10',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0011' THEN MESURE_DNSTY END),3) AS 'SO2',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0012' THEN MESURE_DNSTY END),3) AS 'NO2'
  FROM bdsm.IOT_SENSOR_MESURE_INFO A
   WHERE DATE_FORMAT(MESURE_DT,'%Y%m%d%H%i') = CONCAT(#{startDate},#{startTime},#{startMinute})
GROUP BY A.SPOT_CODE,A.LEGALDONG_CODE,DATE,MESURE_DT) AS B
  		     ON CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE) = CONCAT(B.LEGALDONG_CODE,B.SPOT_CODE)
	</select>
	<select id="fixedBasicFeature" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	    SELECT LA AS POINT_Y,LO AS POINT_X,CONCAT(LEGALDONG_CODE,SPOT_CODE) AS CODE, SENSOR_NM
	      FROM bdsm.IOT_SENSOR_INFO
         WHERE SENSOR_TY_CODE = 'SEN01001'
                 AND SPOT_CODE NOT IN ('0003')
                 AND LO IS NOT NULL
	</select>
	<select id="portableMeasurementClick" parameterType="String" resultType="java.util.HashMap">
   		  SELECT DISTINCT OPR_STTUS_CODE,  DATE_FORMAT(B.DTA_DT,'%Y-%m-%d %h:%i') AS MESURE_DT,
 				 CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE) AS SENSOR_ID, LO AS POINT_X, LA AS POINT_Y
  			FROM bdsm.IOT_SENSOR_SPCS_INFO A,
       			 bdsm.IOT_SENSOR_MVMN_INFO B
 		   WHERE CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE) = CONCAT(B.LEGALDONG_CODE,B.SPOT_CODE)
   			 AND DATE_FORMAT(B.DTA_DT,'%Y-%m-%d %h:%i') = #{MESURE_DT}
   			 AND CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE) = #{CODE}
	</select>
	
	<select id="fixedMeasurementClick" parameterType="String" resultType="java.util.HashMap">
SELECT CONCAT(CTPRVN_NM,' ',SIGNGU_NM,' ',EMD_NM,' ',DONGLI_NM) AS ADDR, 
       SENSOR_NM, 
       CONCAT(AA.LEGALDONG_CODE,SPOT_CODE) AS CODE, 
       LA AS POINT_Y, 
       LO AS POINT_X,
       IFNULL(
			   (SELECT CODE_NM
				  FROM LRN_PTTRN_AI A,
					   COM_CODE B
				 WHERE A.BSML_TRGNPT_SE_CODE = B.CODE
				   AND CONCAT(LEGALDONG_CODE,SPOT_CODE) = CONCAT(AA.LEGALDONG_CODE,AA.SPOT_CODE)
				   AND DATE_FORMAT(MESURE_DT,'%Y%m%d%H%i') = #{DATE}),
				IFNULL(
					   (SELECT CODE_NM
						  FROM LRN_PTTRN_AI A,
							   COM_CODE B
						 WHERE A.BSML_TRGNPT_SE_CODE = B.CODE
						   AND CONCAT(LEGALDONG_CODE,SPOT_CODE) = CONCAT(AA.LEGALDONG_CODE,AA.SPOT_CODE)
						   AND DATE_FORMAT(MESURE_DT,'%Y%m%d%H%i') = (SELECT DATE_FORMAT(MAX(MESURE_DT),'%Y%m%d%H%i') FROM LRN_PTTRN_AI WHERE CONCAT(LEGALDONG_CODE,SPOT_CODE) = CONCAT(AA.LEGALDONG_CODE,AA.SPOT_CODE))),'-')) AS AI
  FROM bdsm.IOT_SENSOR_INFO AA,
       bdsm.LEGALDONG_CODE BB
 WHERE AA.LEGALDONG_CODE = BB.LEGALDONG_CODE
   AND SENSOR_TY_CODE = 'SEN01001'
   AND CONCAT(AA.LEGALDONG_CODE,AA.SPOT_CODE) = #{CODE}
	</select>
	
	<select id="getCity" parameterType="String" resultType="java.util.HashMap">
		 SELECT SIGNGU_NM AS NAME, 
		        SUBSTR(LEGALDONG_CODE,1,5) AS CODE
    	   FROM LEGALDONG_CODE
   		  WHERE LEGALDONG_CODE LIKE '4311%' 
     		AND EMD_NM != ''
	   GROUP BY SIGNGU_NM
       ORDER BY SIGNGU_NM
	</select>
	
	<select id="getTown" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		     SELECT SUBSTR(SIGNGU_NM,4,3) AS SIGNGU_NM,EMD_NM AS NAME, SUBSTR(LEGALDONG_CODE,1,8) AS CODE
    		 FROM bdsm.LEGALDONG_CODE
			WHERE LEGALDONG_CODE LIKE '4311%'
              AND EMD_NM != ''
              AND SIGNGU_NM != ''
		 GROUP BY EMD_NM, SUBSTR(SIGNGU_NM,4,3)
		 ORDER BY SUBSTR(SIGNGU_NM,4,3), EMD_NM
	</select>
	
	<select id="getPOISelect" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	SELECT LCLASDC,
	   	   MLSFCDC,
	   	   SCLASDC
     FROM ( SELECT DISTINCT MLSFCDC,LCLASDC,SCLASDC
  			  FROM shp_poi A
 ORDER BY LCLASDC,MLSFCDC) AA
	</select>
	<select id="getPOISearch" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	  SELECT POIID,
		 	 LCLASDC,
		 	 MLSFCDC,
		 	 SCLASDC,
		 	 FMYNM,
		 	 ETCADRES
    	FROM shp_poi
    	WHERE 1=1
    	<if test="!poiSelect01.equals('전체')">
    		<if test="!poiSelect02.equals('전체')">
    			<if test="poiSelect03.equals('전체')">
    				AND MLSFCDC = #{poiSelect02}
    			</if>
    			<if test="!poiSelect03.equals('전체')">
    				AND SCLASDC =  #{poiSelect03} 
    			</if>
    		</if>
    		<if test="poiSelect02.equals('전체')">
    			AND LCLASDC = #{poiSelect01} 
    		</if>
    	</if>
	 	 <if test="poiText != null">
    			AND FMYNM LIKE CONCAT('%',#{poiText},'%')
  		</if>
	 	 
	</select>
	
	<select id="getArea" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	  SELECT   ANALS_AREA_ID,
		       INTRST_AREA_NM,
		       INTRST_AREA_LC,
		       TPGRPH_AL,
		       PREDICT_AL,
		       UTMX,
		       UTMY
		  FROM ANALS_AREA_MANAGE
		 WHERE GRID_INTRST_SE_CODE = 'ANL01001' 
	 	 <if test="analsAreaId != null">
    			AND GRID_AREA_ID = #{analsAreaId}
  		</if>
	</select>
	
	<select id="odorOriginGrid" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	  SELECT BPLC_ID,
			  CASE WHEN BSML_TRGNPT_SE_CODE = 'BSL01001' THEN '산업단지' 
				  WHEN BSML_TRGNPT_SE_CODE = 'BSL01002' THEN '양돈장' 
                  WHEN BSML_TRGNPT_SE_CODE = 'BSL01003' THEN '환경시설' 
                  WHEN BSML_TRGNPT_SE_CODE = 'BSL01004' THEN '양계장' 
             ELSE '-' END AS BSML_TRGNPT_SE_CODE,
             CMPNY_NM,
             CONCAT(SIGNGU_NM,' ',EMD_NM,' ',LEGALDONG_ETC) AS LEGALDONG_ETC,
             TELNO,
             ERTHSF_AL,
             EXHST_QY
  		FROM bdsm.BPLC_INFO A,
             LEGALDONG_CODE B
	   WHERE A.LEGALDONG_CODE = B.LEGALDONG_CODE
 	     AND A.LEGALDONG_CODE LIKE  CONCAT(#{town}, '%')
 	   <if test="branchName != ''">
   	     AND CMPNY_NM LIKE CONCAT('%', #{branchName}, '%')
   	   </if>
	</select>
	
	<select id="sensoryEvaluationFeature" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	  SELECT SENSE_EVL_NO,X AS POINT_X,Y AS POINT_Y,BSML_FQ
  		FROM shp_sense_evl_real A
	LEFT OUTER JOIN SENSE_EVL B
  		  ON A.SENSE_EVL_ = B.SENSE_EVL_NO
  	WHERE BSML_FQ <![CDATA[>=]]> #{startOU}
	  AND BSML_FQ <![CDATA[<=]]> #{endOU}
	  AND ADM_CODE LIKE CONCAT(#{town}, '%') 
	</select>
	
	<select id="sensoryEvaluationClick" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	  SELECT SENSE_EVL_NO,ADD_TEXT,CONCAT(BSML_FQ,' %') AS BSML_FQ ,X AS POINT_X,Y AS POINT_Y
  		FROM shp_sense_evl_real A
	LEFT OUTER JOIN SENSE_EVL B
  		  ON A.SENSE_EVL_ = B.SENSE_EVL_NO
  	  WHERE SENSE_EVL_NO = #{SENSE_EVL_NO}
	</select>
	
	<select id="sensoryEvaluationGrid" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	  SELECT SENSE_EVL_NO, ADD_TEXT, CONCAT(BSML_FQ,' %') AS BSML_FQ, 
				   CONCAT(SUBSTR(MESURE_DATE,1,4),'-',SUBSTR(MESURE_DATE,6,2),'-',SUBSTR(MESURE_DATE,9,2),' ',SUBSTR(MESURE_TIME,1,2),':',SUBSTR(MESURE_TIME,4,2)) AS MESURE_DATE
            FROM bdsm.shp_sense_evl_real A,
                 bdsm.SENSE_EVL B
		 WHERE A.SENSE_EVL_ = B.SENSE_EVL_NO
		   AND BSML_FQ <![CDATA[>=]]> #{startOU}
	  	   AND BSML_FQ <![CDATA[<=]]> #{endOU}
	  	   AND ADM_CODE LIKE CONCAT(#{town}, '%') 
	</select>
	
	<select id="environmentCorporationItem" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	  SELECT DISTINCT NTWK_NM AS NAME
	    FROM AIRKOREA_MSRSTN_INFO 
	ORDER BY NTWK_NM
	</select>
	
	<select id="environmentCorporationGrid" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	  	   SELECT CODE,
		          NAME,
			      DATE_FORMAT(MESURE_DT,'%Y-%m-%d %H:%i') AS MESURE_DT,
				  SO2_DNSTY,
				  CMO_DNSTY,
				  OZ_DNSTY,
				  NO2_DNSTY,
				  PM10_DNSTY,
				  PM10_HOUR24_PREDICT_MVMN_DNSTY,
				  PM25_DNSTY,
				  PM25_HOUR24_PREDICT_MVMN_DNSTY,
				  UNITY_AIR_ENVRN_NCL,
				  UNITY_AIR_ENVRN_IDEX,
				  SO2_IDEX,
				  CMO_IDEX,
				  OZ_IDEX,
				  NO2_IDEX,
				  PM10_HOUR24_GRAD,
				  PM25_HOUR24_GRAD,
				  PM10_HOUR1_GRAD,
				  PM25_HOUR1_GRAD
  		FROM shp_airkorea_msrstn A
	LEFT OUTER JOIN AIRKOREA_MESURE_INFO B
  		  ON A.CODE = B.MSRSTN_ID
  		 WHERE DATE_FORMAT(MESURE_DT,'%Y%m%d%H') <![CDATA[>=]]> CONCAT(#{startDate},#{startTime})
     	   AND DATE_FORMAT(MESURE_DT,'%Y%m%d%H') <![CDATA[<=]]> CONCAT(#{endDate},#{endTime})
		   AND ADM_CODE LIKE CONCAT(#{town},'%')
		   <if test="branchName != ''">
   	     		AND NAME LIKE CONCAT('%', #{branchName}, '%')
   	   	   </if>
	</select>
	
	<select id="environmentCorporationClick" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	  	   SELECT NAME,
	  	   		  CODE,
	    		  CONCAT(ADDR,' ',ADDR_DETAI) AS ADDR,
			      dm_x as POINT_X,
			      dm_y as POINT_Y
 		     FROM bdsm.shp_airkorea_msrstn
		  	WHERE CODE = #{CODE}
	</select>
	<select id="environmentCorporationFeature" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	  	  SELECT CODE,
				  NAME,
				  dm_x as POINT_X,
			      dm_y as POINT_Y
			 FROM bdsm.shp_airkorea_msrstn
		    WHERE ADM_CODE LIKE CONCAT('4311','%')
		    
		    <if test="branchName != ''">
              AND NAME LIKE CONCAT('%', #{branchName}, '%')
            </if>
              AND ADM_CODE LIKE CONCAT(#{town},'%')
	</select>
	<select id="unmannedOdorFeature" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	  	 SELECT CONCAT(LEGALDONG_CODE,SPOT_CODE) AS CODE,LO AS POINT_X,LA AS POINT_Y, SENSOR_NM
  		   FROM bdsm.IOT_SENSOR_INFO
 		  WHERE SENSOR_TY_CODE = 'SEN01003'
 		    AND LEGALDONG_CODE LIKE CONCAT(#{town},'%')
 		     <if test="branchName != ''">
    			AND SENSOR_NM LIKE CONCAT('%', #{branchName}, '%')
  			</if>  
	</select>
	<select id="unmannedOdorGrid" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        SELECT CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE) AS CODE,
			   C.OPR_STTUS_CODE,
			   B.SENSOR_NM,
			   DATE_FORMAT(MESURE_DT,'%Y%m%d%H%i') AS DATE,
			   DATE_FORMAT(MESURE_DT,'%Y-%m-%d %H:%i') AS MESURE_DT,
			   NVL(MAX(IF(C.IEM_CODE='S0001',CAST(MESURE_DNSTY AS DOUBLE),NULL)),'-') AS 'OU',
			   NVL(MAX(IF(C.IEM_CODE='S0002',CAST(MESURE_DNSTY AS DOUBLE),NULL)),'-') AS 'H2S',
			   NVL(MAX(IF(C.IEM_CODE='S0004',CAST(MESURE_DNSTY AS DOUBLE),NULL)),'-') AS 'VOCS',
			   NVL(MAX(IF(C.IEM_CODE='S0011',CAST(MESURE_DNSTY AS DOUBLE),NULL)),'-') AS 'SOX',
			   NVL(MAX(IF(C.IEM_CODE='S0012',CAST(MESURE_DNSTY AS DOUBLE),NULL)),'-') AS 'NOX'
  		  FROM bdsm.IOT_SENSOR_MESURE_INFO A,
	   		   bdsm.IOT_SENSOR_INFO B,
	   		   bdsm.IOT_SENSOR_SPCS_INFO C,
	   		   bdsm.IOT_MESURE_IEM_MANAGE D
		 WHERE SENSOR_TY_CODE = 'SEN01003'
  		   AND CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE) = CONCAT(B.LEGALDONG_CODE,B.SPOT_CODE)
  		   AND CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE,A.SENSOR_SPCS_NO) = CONCAT(C.LEGALDONG_CODE,C.SPOT_CODE,C.SENSOR_SPCS_NO)
  		   AND CONCAT(B.LEGALDONG_CODE,B.SPOT_CODE) = CONCAT(C.LEGALDONG_CODE,C.SPOT_CODE)
  		   AND D.IEM_CODE = C.IEM_CODE
  		   AND A.LEGALDONG_CODE LIKE CONCAT('%', #{town}, '%')
           AND DATE_FORMAT(MESURE_DT,'%Y%m%d%H') = CONCAT(#{startDate},#{startTime})
           <if test="branchName != ''">
    			AND B.SENSOR_NM LIKE CONCAT('%', #{branchName}, '%')
  			</if>
           GROUP BY CODE,OPR_STTUS_CODE,SENSOR_NM,DATE,MESURE_DT
	</select>
	
	<select id="unmannedOdorClick" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	SELECT LC AS ADDR, SENSOR_NM, CONCAT(LEGALDONG_CODE,SPOT_CODE) AS CODE, LA AS POINT_Y, LO AS POINT_X
  	  FROM bdsm.IOT_SENSOR_INFO
 	 WHERE SENSOR_TY_CODE = 'SEN01003'
       AND CONCAT(LEGALDONG_CODE,SPOT_CODE) = #{CODE}
	</select>
	
	<select id="observatoryFeature" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	SELECT STATION_ID, 
		   longitude AS POINT_X, 
		   latitude AS POINT_Y,
		   NAME
      FROM bdsm.shp_obsr_spot
     WHERE ADM_CODE LIKE CONCAT(#{town},'%')
       AND STATION_ID = '131'
	</select>
	
	<select id="observatoryGrid" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	SELECT STATION_ID, 
		  NAME, 
          CONCAT(SUBSTR(OBSR_TIME,1,4),'-',SUBSTR(OBSR_TIME,5,2),'-',SUBSTR(OBSR_TIME,7,2),' ',SUBSTR(OBSR_TIME,9,2),':',SUBSTR(OBSR_TIME,11,2)) AS OBSR_TIME, 
          CASE WHEN TRUNCATE(MIN60_ACCMLT_RAINFL,1) =-99.9 THEN 0 ELSE MIN60_ACCMLT_RAINFL END AS MIN60_ACCMLT_RAINFL,
          CASE WHEN TRUNCATE(DE_RAINFL,1) =-99.9 THEN 0 ELSE DE_RAINFL END AS DE_RAINFL,
          TMPRT, 
          MXMM_MONT_WD, 
          MXMM_MONT_WS, 
          MIN10_AVRG_WD, 
          MIN10_AVRG_WS, 
          HD
  		FROM bdsm.shp_obsr_spot A,
             bdsm.AWS_OBSR_INFO B
	   WHERE A.STATION_ID = B.OBSR_SPOT_ID
         AND STATION_ID = '131'
         AND A.ADM_CODE LIKE CONCAT(#{town},'%')
         AND CONCAT(SUBSTR(OBSR_TIME,1,4),SUBSTR(OBSR_TIME,5,2),SUBSTR(OBSR_TIME,7,2),SUBSTR(OBSR_TIME,9,2)) <![CDATA[>=]]> CONCAT(#{startDate},#{startTime})
  		 AND CONCAT(SUBSTR(OBSR_TIME,1,4),SUBSTR(OBSR_TIME,5,2),SUBSTR(OBSR_TIME,7,2),SUBSTR(OBSR_TIME,9,2)) <![CDATA[<=]]> CONCAT(#{endDate},#{endTime})
	</select>
	
	<select id="observatoryClick" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	SELECT STATION_ID,
	       POS,
	       NAME, 
	       longitude AS POINT_X, 
	       latitude AS POINT_Y
      FROM bdsm.shp_obsr_spot
     WHERE STATION_ID = #{STATION_ID}
	</select>
	
	<select id="iotSensorInfoFeature" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT TAB.POINT_X,
			   TAB.POINT_Y,
			   OU,
			   H2S,
			   VOCS,
			   ETHANOL,
			   TMA,
			   CH3SH,
			   CFC,
			   PM2_5,
			   PM10,
			   SO2,
			   NO2,
			   SENSOR_NM
			    FROM (
SELECT CASE WHEN LO IS NULL THEN POINT_X ELSE LO END AS POINT_X,
			CASE WHEN LA IS NULL THEN POINT_Y ELSE LA END AS POINT_Y,
			OU,
			   H2S,
			   VOCS,
			   ETHANOL,
			   TMA,
			   CH3SH,
			   CFC,
			   PM2_5,
			   PM10,
			   SO2,
			   NO2,
			   SENSOR_NM
	  FROM ( SELECT * 
			   FROM bdsm.IOT_SENSOR_INFO
			  WHERE SENSOR_TY_CODE = #{radio}
			) AA
LEFT OUTER JOIN ( SELECT CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE) AS CODE,
					   DATE_FORMAT(MESURE_DT,'%Y년 %m월 %d일 %H시 %i분') AS MESURE_DT,
                       LA AS POINT_Y,
                       LO AS POINT_X,
					  TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0001' THEN MESURE_DNSTY END),3) AS 'OU',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0002' THEN MESURE_DNSTY END),3) AS 'H2S',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0004' THEN MESURE_DNSTY END),3) AS 'VOCS',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0005' THEN MESURE_DNSTY END),3) AS 'ETHANOL',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0006' THEN MESURE_DNSTY END),3) AS 'TMA',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0007' THEN MESURE_DNSTY END),3) AS 'CH3SH',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0008' THEN MESURE_DNSTY END),3) AS 'CFC',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0009' THEN MESURE_DNSTY END),3) AS 'PM2_5',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0010' THEN MESURE_DNSTY END),3) AS 'PM10',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0011' THEN MESURE_DNSTY END),3) AS 'SO2',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0012' THEN MESURE_DNSTY END),3) AS 'NO2',
                       DATE_FORMAT(MESURE_DT,'%Y%m%d%H%i') AS DATE
				FROM bdsm.IOT_SENSOR_MESURE_INFO A
                WHERE DATE_FORMAT(MESURE_DT,'%Y%m%d%H%i') = CONCAT(#{startDate},#{startTime},#{startMinute})
                 GROUP BY CODE,MESURE_DT,POINT_Y,POINT_X
			 ) BB
		ON CONCAT(AA.LEGALDONG_CODE,AA.SPOT_CODE) = CODE) TAB
WHERE TAB.POINT_X IS NOT NULL
	</select>
	
	<!-- 관심지역 -->
	<select id="getIntrstList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	SELECT ANALS_AREA_ID AS "analsAreaId", 
	       INTRST_AREA_NM AS "intrstAreaNm", 
	       GRID_AREA_ID AS "gridAreaId" 
      FROM ANALS_AREA_MANAGE 
     WHERE GRID_INTRST_SE_CODE = 'ANL01002'
	</select>
	<!-- 센서 -->
	<select id="getSensorList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	SELECT SPOT_CODE AS "spotCode", 
	       SENSOR_NM AS "sensorNm",
	       LA AS "latitude",
	       LO AS "longitude"
	  FROM IOT_SENSOR_INFO 
	 WHERE SENSOR_TY_CODE = 'SEN01001' AND ( LA IS NOT NULL AND LO IS NOT NULL)
	</select>
	
	<select id="getCoursModel" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	SELECT ANALS_AREA_ID AS "analsAreaId", 
	       DATE_FORMAT(DTA_DT,'%Y%m%d%H') AS "dtaDt", 
	       SN AS "sn", 
	       REPLACE(FORMAT(UTMX,0),',','') AS "utmx", 
	       REPLACE(FORMAT(UTMY,0),',','') AS "utmy" 
	  FROM ${tableNm}
	 WHERE ANALS_AREA_ID = #{analsAreaId} AND DATE_FORMAT(DTA_DT,'%Y%m%d%H') = #{dtaDt}
	</select>
	<select id="getCoursModelBySensor" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	SELECT SPOT_CODE AS "analsAreaId", 
	       DATE_FORMAT(DTA_DT,'%Y%m%d%H') AS "dtaDt", 
	       SN AS "sn", 
	       REPLACE(FORMAT(UTMX,0),',','') AS "utmx", 
	       REPLACE(FORMAT(UTMY,0),',','') AS "utmy" 
	  FROM RLTM_SENSOR_MVMN_COURS_MODEL
	 WHERE SPOT_CODE = #{analsAreaId} AND DATE_FORMAT(DTA_DT,'%Y%m%d%H')  = #{dtaDt}
	</select>
	
	<select id="odorReductionGrid" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  			SELECT C.BPLC_ID,
               C.REDUC_EQP_NM,
               C.REGISTER_ID,
               CMPNY_NM,
               CONCAT(SIGNGU_NM,' ',EMD_NM,' ',LEGALDONG_ETC) AS LEGALDONG_ETC,
			   TELNO
           FROM BPLC_INFO A,
                LEGALDONG_CODE B,
                BSML_REDUC_EQP_INFO C
		WHERE A.LEGALDONG_CODE = B.LEGALDONG_CODE
          AND A.BPLC_ID = C.BPLC_ID
          AND A.LEGALDONG_CODE LIKE CONCAT(#{town},'%')
          <if test="branchName != ''">
    			AND CMPNY_NM LIKE CONCAT('%', #{branchName}, '%')
  			</if>
	</select>
	<select id="getChart" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT * FROM (SELECT CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE) AS CODE,
			   B.SENSOR_NM, 
               OPR_STTUS_CODE,
			   DATE_FORMAT(MESURE_DT,'%Y%m%d%H%i') AS DATE, 
			   DATE_FORMAT(MESURE_DT,'%H:%i') AS MESURE_DT,
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0001' THEN MESURE_DNSTY END),3) AS 'OU',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0002' THEN MESURE_DNSTY END),3) AS 'H2S',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0004' THEN MESURE_DNSTY END),3) AS 'VOCS',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0003' THEN MESURE_DNSTY END),3) AS 'NH3'
  		  FROM bdsm.IOT_SENSOR_MESURE_INFO A,
	   		   bdsm.IOT_SENSOR_INFO B
  		   WHERE CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE) = CONCAT(B.LEGALDONG_CODE,B.SPOT_CODE)
           
           <if test="mesureDt != 1">
    			AND DATE_FORMAT(MESURE_DT,'%Y%m%d%H%i') = #{mesureDt}
  			</if>
  			<if test="mesureDt == 1">
    			AND DATE_FORMAT(MESURE_DT,'%Y%m%d%H') >= DATE_FORMAT(DATE_ADD(NOW(), INTERVAL - 1 HOUR),'%Y%m%d%H')
  			</if>
   		   
     	   AND CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE) = #{code}
  		   GROUP BY CODE,B.SENSOR_NM,OPR_STTUS_CODE,DATE,MESURE_DT
  		   ORDER BY DATE DESC
           LIMIT 6 ) AA ORDER BY DATE
	</select>
	<select id="reductionMonitoringGrid" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		 SELECT CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE) AS CODE,
			   B.SENSOR_NM,
               OPR_STTUS_CODE,
			   DATE_FORMAT(MESURE_DT,'%Y%m%d%H%i') AS DATE,
			   DATE_FORMAT(MESURE_DT,'%Y-%m-%d %H:%i') AS MESURE_DT,
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0001' THEN MESURE_DNSTY END),3) AS 'OU'
  		  FROM bdsm.IOT_SENSOR_MESURE_INFO A,
	   		   bdsm.IOT_SENSOR_INFO B
		 WHERE  SENSOR_TY_CODE = 'SEN01004'
  		   AND CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE) = CONCAT(B.LEGALDONG_CODE,B.SPOT_CODE)
  		   AND A.LEGALDONG_CODE LIKE CONCAT(#{town}, '%')
   		   AND DATE_FORMAT(MESURE_DT,'%Y%m%d%H%i') = CONCAT(#{startDate},#{startTime},#{startMinute})
     	    <if test="branchName != ''">
    			AND B.SENSOR_NM LIKE CONCAT('%', #{branchName}, '%')
  			</if>
  		   GROUP BY CODE,B.SENSOR_NM,OPR_STTUS_CODE,DATE,MESURE_DT;
	</select>
	
	<select id="reductionMonitoringClick" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT CONCAT(CTPRVN_NM,' ',SIGNGU_NM,' ',EMD_NM,' ',DONGLI_NM) AS ADDR, SENSOR_NM, CONCAT(A.LEGALDONG_CODE,SPOT_CODE) AS CODE, LA AS POINT_Y, LO AS POINT_X
				   FROM bdsm.IOT_SENSOR_INFO A,
                        bdsm.LEGALDONG_CODE B
		          WHERE A.LEGALDONG_CODE = B.LEGALDONG_CODE
                    AND SENSOR_TY_CODE = 'SEN01004'
                    AND CONCAT(A.LEGALDONG_CODE,SPOT_CODE) = #{CODE}
	</select>
	
	<select id="chartClick" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		 SELECT CONCAT(SUBSTR(LEGALDONG_CODE,1,6),SPOT_CODE) AS CODE,SENSOR_NM,LO,LA
               FROM bdsm.IOT_SENSOR_INFO
			 WHERE CONCAT(LEGALDONG_CODE,SPOT_CODE) = #{code}
	</select>
	
	<select id="reductionMonitoringFeature" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE) AS CODE,
                OPR_STTUS_CODE,
                SENSOR_NM,
                A.LA AS POINT_Y,
                A.LO AS POINT_X,
                MESURE_DT,
                DATE,
                OU,
			   H2S,
			   VOCS,
			   ETHANOL,
			   TMA,
			   CH3SH,
			   CFC,
			   PM2_5,
			   PM10,
			   SO2,
			   NO2
           FROM (SELECT * 
				   FROM bdsm.IOT_SENSOR_INFO
		          WHERE SENSOR_TY_CODE = 'SEN01004'
                    AND LO IS NOT NULL
                    AND LEGALDONG_CODE LIKE CONCAT(#{town},'%')
                    <if test="branchName != ''">
    					AND SENSOR_NM LIKE CONCAT('%', #{branchName}, '%')
  					</if>
  					) AS A
LEFT OUTER JOIN (SELECT A.SPOT_CODE,
						A.LEGALDONG_CODE,DATE_FORMAT(MESURE_DT,'%Y%m%d%H%i') AS DATE,
			   DATE_FORMAT(MESURE_DT,'%Y년 %m월 %d일 %H시 %i분') AS MESURE_DT,
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0001' THEN MESURE_DNSTY END),3) AS 'OU',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0002' THEN MESURE_DNSTY END),3) AS 'H2S',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0004' THEN MESURE_DNSTY END),3) AS 'VOCS',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0005' THEN MESURE_DNSTY END),3) AS 'ETHANOL',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0006' THEN MESURE_DNSTY END),3) AS 'TMA',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0007' THEN MESURE_DNSTY END),3) AS 'CH3SH',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0008' THEN MESURE_DNSTY END),3) AS 'CFC',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0009' THEN MESURE_DNSTY END),3) AS 'PM2_5',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0010' THEN MESURE_DNSTY END),3) AS 'PM10',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0011' THEN MESURE_DNSTY END),3) AS 'SO2',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0012' THEN MESURE_DNSTY END),3) AS 'NO2'
  FROM bdsm.IOT_SENSOR_MESURE_INFO A
  WHERE DATE_FORMAT(MESURE_DT,'%Y%m%d%H%i') = CONCAT(#{startDate},#{startTime},#{startMinute})
GROUP BY A.SPOT_CODE,A.LEGALDONG_CODE,DATE,MESURE_DT) AS B
  		     ON CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE) = CONCAT(B.LEGALDONG_CODE,B.SPOT_CODE)
	</select>
	
	<update id="updateSensor" parameterType="java.util.HashMap">
		UPDATE IOT_SENSOR_INFO SET LO = #{lo}, LA = #{la} WHERE SPOT_CODE = #{spotCode} AND SENSOR_TY_CODE = 'SEN01001'
	</update>
	
	<select id="getAnalsAreaId" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT ANALS_AREA_ID AS "analsAreaId", 
		       GRID_AREA_ID AS "gridAreaId" 
		  FROM ANALS_AREA_MANAGE 
		 WHERE GRID_INTRST_SE_CODE = 'ANL01002'
		   AND GRID_AREA_ID = #{analsAreaId} 
	</select>
	<!-- 개발팀 csw -->
	<!-- 민원분류 -->
	<select id="getCvplTyCode" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT CODE, CODE_NM
		  FROM COM_CODE
		WHERE UPPER_CODE_NO=201
		ORDER BY SORT_ORDR
	</select>
	
	<!-- 청주시군구 조회 -->
	<select id="getSigunguCode" parameterType="Map" resultType="hashMap">
		SELECT SIGNGU_NM, LEGALDONG_CODE
		  FROM LEGALDONG_CODE
		 WHERE LEGALDONG_CODE LIKE CONCAT('4311','%')
		   AND EMD_NM = ''
		 ORDER BY LEGALDONG_CODE
	</select>
	
	<!-- 민원데이터 list -->
    <select id="getCvplDataManageList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
            SELECT DATE_FORMAT(CVPL_DT,'%Y-%m-%d %H시') AS CVPL_DE,
			       CPTTR,
			       CPTTR_CTTPC,
			       CVPL_LC,
			       CVPL_CN,
			       LA,
			       LO,
			       (SELECT CODE_NM FROM COM_CODE C WHERE C.UPPER_CODE_NO=201 AND CODE=CVPL_TY_CODE) AS CVPL_TY_NM,
			       CVPL_NO,
			       COUNT(1)OVER() AS DTA_CO
			  FROM (SELECT #{from_date} AS PARAMETER_1,
                           #{to_date} AS PARAMETER_2,
                           <choose>
                            <when test="cpttr !=null and cpttr !=''">
                            #{cpttr} AS PARAMETER_3,
                            </when>
                            <otherwise>
                            '' AS PARAMETER_3,
                            </otherwise>
                           </choose>
                           #{cvplTyCode} AS PARAMETER_4
			       ) A,
			       CVPL_MANAGE B
			 WHERE B.CVPL_DT BETWEEN DATE_FORMAT(CONCAT(RPAD(PARAMETER_1,8,'01'),'000000'),'%Y-%m-%d %T') AND IF(LENGTH(PARAMETER_2)=8,DATE_FORMAT(CONCAT(PARAMETER_2,'235959'),'%Y-%m-%d %T'),DATE_ADD(DATE_ADD(DATE_FORMAT(CONCAT(PARAMETER_2,'01'),'%Y-%m-%d %T'),INTERVAL 1 MONTH),INTERVAL -1 SECOND))
			   AND B.CPTTR LIKE CONCAT('%',PARAMETER_3,'%')
			   AND B.CVPL_TY_CODE = IF(A.PARAMETER_4='',B.CVPL_TY_CODE,A.PARAMETER_4)
			 ORDER BY CVPL_DT, CVPL_NO
    </select>
    
    <!-- 민원등록 -->
    <insert id="insertCvplData" parameterType="java.util.HashMap">
		INSERT INTO CVPL_MANAGE
        (
            CVPL_DT, CPTTR, CPTTR_CTTPC, LEGALDONG_CODE, CVPL_LC, CVPL_CN, REGIST_DT, REGISTER_ID, CHANGE_DT, CHANGER_ID, LA, LO, CVPL_TY_CODE
        )
        VALUES
        (
            #{date}, #{man}, #{phone}, #{addr}, #{direct}, #{contents}, SYSDATE(), 'cetech', SYSDATE(), 'cetech', #{y}, #{x}, #{flag}
        )
	</insert>
	
	<!-- 민원데이터 수정 -->
    <update id="updateCvplData" parameterType="java.util.HashMap">
        UPDATE CVPL_MANAGE
        <set> 
        CVPL_DT         = #{date},
        CPTTR           = #{man},
        CPTTR_CTTPC    = #{phone},
        LEGALDONG_CODE = #{addr},
        CVPL_LC           = #{direct},
        LA         			 = #{y},
    	LO        			 = #{x}, 
        CVPL_TY_CODE = #{flag},
        CVPL_CN         = #{contents},
        CHANGE_DT       = SYSDATE(),
        CHANGER_ID      = 'cetech'
        </set>

        WHERE CVPL_NO = #{code}
    </update>
    
    <!-- 민원데이터 상세보기 -->
    <select id="getCvplDataDetail" parameterType="Map" resultType="hashMap">
        SELECT DATE_FORMAT(CVPL_DT,'%Y-%m-%d') AS CVPL_DE,
           DATE_FORMAT(CVPL_DT,'%H') AS CVPL_HR,
           CPTTR,
           CPTTR_CTTPC,
           LEGALDONG_CODE,
           CVPL_LC,
           LA,
           LO,
           CVPL_TY_CODE,
           CVPL_CN,
           CVPL_NO
        FROM CVPL_MANAGE
        WHERE CVPL_NO = #{CVPL_NO}
    </select>
	
	<!-- 악취저감설비 정보 -->
	<select id="getBsmlReduceqpInfo" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		WITH BASE AS
			(
			 SELECT A.BPLC_ID, A.REDUC_EQP_NO, A.REDUC_EQP_NM, B.BSML_TRGNPT_NM, PARAMETER_3
			   FROM (
			         SELECT B.BPLC_ID, B.REDUC_EQP_NO, B.REDUC_EQP_NM, PARAMETER_3
			           FROM (SELECT #{bplcId} AS PARAMETER_1, -- 돈사ID
			                        '' AS PARAMETER_2, -- 저감설비NO
			                        '' AS PARAMETER_3  -- 상태
			                ) A,
			                BSML_REDUC_EQP_INFO B
			          WHERE B.BPLC_ID=IF(PARAMETER_1='',B.BPLC_ID,PARAMETER_1)
			            AND B.REDUC_EQP_NO=IF(PARAMETER_2='',B.REDUC_EQP_NO,PARAMETER_2)
			        ) A,
			        BPLC_INFO B
			  WHERE B.BPLC_ID=A.BPLC_ID
			)
			SELECT
			       BPLC_ID, BSML_TRGNPT_NM, REDUC_EQP_NM, OPR_STTUS_NM, REDUC_EQP_NO, DTA_CO, CTRL_CN_CODE, BUTTON_USEABLE_AT
			  FROM (
			        SELECT A.BPLC_ID, A.BSML_TRGNPT_NM, A.REDUC_EQP_NM, B.OPR_STTUS_NM,
			               A.REDUC_EQP_NO,
			               COUNT(1)OVER() AS DTA_CO,
			               CASE WHEN B.OPR_STTUS_NM='ON' THEN 'COM08002 '
			                    WHEN B.OPR_STTUS_NM='OFF' THEN 'COM08001'
			                END AS CTRL_CN_CODE,
			               IF((SELECT COUNT(BPLC_ID) FROM BSML_REDUC_EQP_CTRL_HIST C WHERE C.BPLC_ID=A.BPLC_ID AND C.REDUC_EQP_NO=A.REDUC_EQP_NO AND C.CTRL_RESULT_CODE IS NULL)=0,'Y','N') AS BUTTON_USEABLE_AT,
			               CASE WHEN A.PARAMETER_3='' THEN ''
			                    WHEN A.PARAMETER_3='COM08001' THEN 'ON'
			                    WHEN A.PARAMETER_3='COM08002' THEN 'OFF'
			                END AS PARAMETER_3
			          FROM BASE A
			               LEFT JOIN
			               (SELECT BPLC_ID, REDUC_EQP_NO, 
			                       CASE WHEN OPR_STTUS_CODE IN ('COM02000','COM08001') THEN 'ON'
			                            WHEN OPR_STTUS_CODE IN ('COM02003','COM08002') THEN 'OFF'
			                        END AS OPR_STTUS_NM
			                  FROM (
			                        SELECT BPLC_ID, REDUC_EQP_NO, OPR_STTUS_CODE,
			                               ROW_NUMBER()OVER(PARTITION BY BPLC_ID, REDUC_EQP_NO ORDER BY DTA_DT DESC) AS RN
			                          FROM (
			                                SELECT DISTINCT B.BPLC_ID, B.REDUC_EQP_NO, B.DTA_DT, B.OPR_STTUS_CODE
			                                  FROM (
			                                        SELECT B.BPLC_ID, B.REDUC_EQP_NO,
			                                               MAX(DTA_DT) AS MAX_DATE
			                                          FROM BASE A,
			                                               BSML_REDUC_EQP_OPR_STTUS B
			                                         WHERE B.BPLC_ID=A.BPLC_ID
			                                           AND B.REDUC_EQP_NO=A.REDUC_EQP_NO
			                                         GROUP BY B.BPLC_ID, B.REDUC_EQP_NO
			                                       ) A,
			                                       BSML_REDUC_EQP_OPR_STTUS B
			                                 WHERE B.BPLC_ID=A.BPLC_ID
			                                   AND B.REDUC_EQP_NO=A.REDUC_EQP_NO
			                                   AND B.DTA_DT=A.MAX_DATE
			                                UNION
			                                SELECT DISTINCT B.BPLC_ID, B.REDUC_EQP_NO, B.EQP_CTRL_DT, B.CTRL_CN_CODE
			                                  FROM (
			                                        SELECT B.BPLC_ID, B.REDUC_EQP_NO,
			                                               MAX(EQP_CTRL_DT) AS MAX_DATE
			                                          FROM BASE A,
			                                               BSML_REDUC_EQP_CTRL_HIST B
			                                         WHERE B.BPLC_ID=A.BPLC_ID
			                                           AND B.REDUC_EQP_NO=A.REDUC_EQP_NO
			                                           AND B.CTRL_RESULT_CODE='COM05000'
			                                         GROUP BY B.BPLC_ID, B.REDUC_EQP_NO
			                                       ) A,
			                                       BSML_REDUC_EQP_CTRL_HIST B
			                                 WHERE B.BPLC_ID=A.BPLC_ID
			                                   AND B.REDUC_EQP_NO=A.REDUC_EQP_NO
			                                   AND B.EQP_CTRL_DT=A.MAX_DATE
			                               ) A
			                       ) A
			                 WHERE RN=1
			               ) B
			               ON (B.BPLC_ID=A.BPLC_ID
			               AND B.REDUC_EQP_NO=A.REDUC_EQP_NO
			                  )
			       ) A
			 WHERE OPR_STTUS_NM=IF(PARAMETER_3='',OPR_STTUS_NM,PARAMETER_3)
			 ORDER BY BPLC_ID, BSML_TRGNPT_NM, REDUC_EQP_NM, REDUC_EQP_NO
	</select>
	
	<!-- 저감설비 원격제어 -->
	<insert id="insertOnOff" parameterType="java.util.HashMap">
		INSERT INTO BSML_REDUC_EQP_CTRL_HIST (BPLC_ID, REDUC_EQP_NO, CTRL_SE_CODE, CTRL_REQUST_DT, CTRL_CN_CODE, CNTLR_ID)
		VALUES (#{bplcId}, #{reducEqpNo}, 'COM04003',SYSDATE(),#{ctrlCnCode},'cetech');
	</insert>
	
	<!-- 센서 선택 - 이동식 -->
	<select id="getDeviceList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT CONCAT(SENSOR_NM,'(',SUBSTR(LEGALDONG_CODE,1,5),SPOT_CODE,')') AS SENSOR_NM
		     , LEGALDONG_CODE, SPOT_CODE
		  FROM IOT_SENSOR_INFO
		 WHERE SENSOR_TY_CODE='SEN01002'
		   AND USE_AT='Y'
		 ORDER BY SENSOR_NM
	</select>
	
	<!-- 센서 조회 - 이동식 -->
	<select id="getDeviceInfoList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT CONCAT(SUBSTR(A.LEGALDONG_CODE,1,5),A.SPOT_CODE) AS SENSOR_ID
		     , MAX(C.SENSOR_NM) AS SENSOR_NM
		     , DATE_FORMAT(MIN(B.MESURE_DT),'%Y-%m-%d %T') AS START_DT -- KEY
		     , DATE_FORMAT(MAX(B.MESURE_DT),'%Y-%m-%d %T') AS END_DT -- KEY
		     , A.LA, A.LO 
		     , A.LEGALDONG_CODE, A.SPOT_CODE -- KEY
		     , COUNT(1)OVER() AS DTA_CO
		  FROM (
		        SELECT LEGALDONG_CODE, SPOT_CODE, DTA_DT, LA, LO
		             , DATE_ADD(NVL(LEAD(DTA_DT)OVER(PARTITION BY LEGALDONG_CODE, SPOT_CODE ORDER BY DTA_DT),SYSDATE()), INTERVAL -1 SECOND) AS END_DT
		             , PARAMETER_4
		          FROM (SELECT #{legaldongCode} AS PARAMETER_1 -- LEGALDONG_CODE
		                     , #{spotCode} AS PARAMETER_2 -- SPOT_CODE
		                     , #{from_date} AS PARAMETER_3 -- 조회시작일(필수:YYYYMMDD)
		                     , #{to_date} AS PARAMETER_4 -- 조회종료일(필수:YYYYMMDD)
		               ) A
		             , IOT_SENSOR_MVMN_INFO B
		         WHERE B.LEGALDONG_CODE=IF(A.PARAMETER_1='',B.LEGALDONG_CODE,A.PARAMETER_1)
		           AND B.SPOT_CODE=IF(A.PARAMETER_2='',B.SPOT_CODE,A.PARAMETER_2)
		           AND B.DTA_DT >= DATE_FORMAT(CONCAT(PARAMETER_3,'000000'),'%Y-%m-%d %T')
		       ) A
		     , IOT_SENSOR_MESURE_INFO B
		     , IOT_SENSOR_INFO C
		 WHERE A.DTA_DT &lt;= DATE_FORMAT(CONCAT(PARAMETER_4,'235959'),'%Y-%m-%d %T')
		   AND B.LEGALDONG_CODE=A.LEGALDONG_CODE
		   AND B.SPOT_CODE=A.SPOT_CODE
		   AND B.IEM_CODE='S0001'
		   AND B.MESURE_DT BETWEEN A.DTA_DT AND A.END_DT
		   AND C.LEGALDONG_CODE=B.LEGALDONG_CODE
		   AND C.SPOT_CODE=B.SPOT_CODE
		   AND C.USE_AT='Y'
		 GROUP BY A.LEGALDONG_CODE, A.SPOT_CODE, A.DTA_DT, A.LA, A.LO
		 ORDER BY C.SENSOR_NM, A.LEGALDONG_CODE, A.SPOT_CODE, A.DTA_DT
	</select>
	
	<!-- 센서 차트 조회 - 이동식 -->
	<select id="getDeviceChartList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		WITH BASE AS (
		SELECT PARAMETER_1 AS LEGALDONG_CODE
		     , PARAMETER_2 AS SPOT_CODE
		     , DATE_FORMAT(PARAMETER_3,'%Y-%m-%d %T') AS START_DT
		     , TIMESTAMPDIFF(DAY,DATE_FORMAT(PARAMETER_3,'%Y-%m-%d %T'), DATE_FORMAT(PARAMETER_4,'%Y-%m-%d %T'))+1 AS DE_CO
		     , PARAMETER_5 AS LA
		     , PARAMETER_6 AS LO
		  FROM (SELECT #{legaldongCode} AS PARAMETER_1 -- LEGALDONG_CODE (필수)
		             , #{spotCode} AS PARAMETER_2 -- SPOT_CODE (필수)
		             , #{startDt} AS PARAMETER_3 -- START_DT (필수)
		             , #{endDt} AS PARAMETER_4 -- END_DT (필수)
		             , #{la} AS PARAMETER_5 -- LA (위도)
		             , #{lo} AS PARAMETER_6 -- LO (경도)
		             
		       ) A
		)
		SELECT A.LEGALDONG_CODE, A.SPOT_CODE
		     , DATE_FORMAT(A.MESURE_START_DT,'%Y-%m-%d %H') AS MESURE_DT
		     , CAST(ROUND(AVG(B.MESURE_DNSTY),3) AS DOUBLE) AS AVG_VALUE
		     , DATE_FORMAT(MIN(MESURE_START_DT)OVER(),'%Y-%m-%d %H') AS START_DT
		     , DATE_FORMAT(MAX(MESURE_START_DT)OVER(),'%Y-%m-%d %H') AS END_DT
		     , A.LA, A.LO
		  FROM (
		        SELECT A.LEGALDONG_CODE, A.SPOT_CODE
		             , DATE_ADD(DATE_ADD(START_DT,INTERVAL C.NO-1 HOUR),INTERVAL B.NO-1 DAY) AS MESURE_START_DT
		             , DATE_ADD(DATE_ADD(DATE_ADD(START_DT,INTERVAL C.NO HOUR),INTERVAL B.NO-1 DAY),INTERVAL -1 SECOND) AS MESURE_END_DT
		             , LA, LO
		          FROM BASE A
		             , ROW_CREAT B
		             , ROW_CREAT C
		         WHERE B.NO &lt;= DE_CO
		           AND C.NO &lt;= 24
		       ) A
		       LEFT JOIN
		       IOT_SENSOR_MESURE_INFO B
		       ON (B.LEGALDONG_CODE=A.LEGALDONG_CODE
		       AND B.SPOT_CODE=A.SPOT_CODE
		       AND B.IEM_CODE='S0001'
		       AND B.MESURE_DT BETWEEN A.MESURE_START_DT AND MESURE_END_DT
		          )
		 GROUP BY A.LEGALDONG_CODE, A.SPOT_CODE, A.MESURE_START_DT
		 ORDER BY A.MESURE_START_DT
	</select>
	
	<!-- 악취발생예보 -->
	<select id="getForeCastOccurrence" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT SUM(CASE WHEN DTA_01 LIKE 'O%' THEN 1 ELSE 0 END) AS DTA_01_SUM
		     , SUM(CASE WHEN DTA_02 LIKE 'O%' THEN 1 ELSE 0 END) AS DTA_02_SUM
		     , SUM(CASE WHEN DTA_03 LIKE 'O%' THEN 1 ELSE 0 END) AS DTA_03_SUM
		     , SUM(CASE WHEN DTA_04 LIKE 'O%' THEN 1 ELSE 0 END) AS DTA_04_SUM
		     , DATE_FORMAT(MAX(DTA_DT),'%Y-%m-%d') AS DTA_DE_01
		     , DATE_FORMAT(DATE_ADD(MAX(DTA_DT),INTERVAL 6 HOUR),'%Y-%m-%d') AS DTA_DE_02
		     , DATE_FORMAT(DATE_ADD(MAX(DTA_DT),INTERVAL 12 HOUR),'%Y-%m-%d') AS DTA_DE_03
		     , DATE_FORMAT(DATE_ADD(MAX(DTA_DT),INTERVAL 18 HOUR),'%Y-%m-%d') AS DTA_DE_04
		     , CASE WHEN DATE_FORMAT(MAX(DTA_DT),'%H') = '00' THEN '새벽'
		            WHEN DATE_FORMAT(MAX(DTA_DT),'%H') = '06' THEN '오전'
		            WHEN DATE_FORMAT(MAX(DTA_DT),'%H') = '12' THEN '오후'
		            WHEN DATE_FORMAT(MAX(DTA_DT),'%H') = '18' THEN '저녁'
		        END AS DTA_TIME_01
		     , CASE WHEN DATE_FORMAT(DATE_ADD(MAX(DTA_DT),INTERVAL 6 HOUR),'%H') = '00' THEN '새벽'
		            WHEN DATE_FORMAT(DATE_ADD(MAX(DTA_DT),INTERVAL 6 HOUR),'%H') = '06' THEN '오전'
		            WHEN DATE_FORMAT(DATE_ADD(MAX(DTA_DT),INTERVAL 6 HOUR),'%H') = '12' THEN '오후'
		            WHEN DATE_FORMAT(DATE_ADD(MAX(DTA_DT),INTERVAL 6 HOUR),'%H') = '18' THEN '저녁'
		        END AS DTA_TIME_02
		     , CASE WHEN DATE_FORMAT(DATE_ADD(MAX(DTA_DT),INTERVAL 12 HOUR),'%H') = '00' THEN '새벽'
		            WHEN DATE_FORMAT(DATE_ADD(MAX(DTA_DT),INTERVAL 12 HOUR),'%H') = '06' THEN '오전'
		            WHEN DATE_FORMAT(DATE_ADD(MAX(DTA_DT),INTERVAL 12 HOUR),'%H') = '12' THEN '오후'
		            WHEN DATE_FORMAT(DATE_ADD(MAX(DTA_DT),INTERVAL 12 HOUR),'%H') = '18' THEN '저녁'
		        END AS DTA_TIME_03
		     , CASE WHEN DATE_FORMAT(DATE_ADD(MAX(DTA_DT),INTERVAL 18 HOUR),'%H') = '00' THEN '새벽'
		            WHEN DATE_FORMAT(DATE_ADD(MAX(DTA_DT),INTERVAL 18 HOUR),'%H') = '06' THEN '오전'
		            WHEN DATE_FORMAT(DATE_ADD(MAX(DTA_DT),INTERVAL 18 HOUR),'%H') = '12' THEN '오후'
		            WHEN DATE_FORMAT(DATE_ADD(MAX(DTA_DT),INTERVAL 18 HOUR),'%H') = '18' THEN '저녁'
		        END AS DTA_TIME_04
		FROM (
		      SELECT ANALS_AREA_ID
		           , MAX(INTRST_AREA_NM) AS INTRST_AREA_NM
		           , MAX(PREDICT_AL) AS INTRST_AREA_AL
		           , MAX(IF(NO=1,EX_AT,NULL)) AS DTA_01
		           , MAX(IF(NO=2,EX_AT,NULL)) AS DTA_02
		           , MAX(IF(NO=3,EX_AT,NULL)) AS DTA_03
		           , MAX(IF(NO=4,EX_AT,NULL)) AS DTA_04
		           , MAX(DTA_DT) AS DTA_DT
		        FROM (SELECT A.ANALS_AREA_ID, A.INTRST_AREA_NM, A.NO, A.PREDICT_AL,
		                     A.STDRVALUE, B.BSML_DNSTY,
		                     CASE WHEN B.BSML_DNSTY IS NULL THEN '-'
		                          WHEN B.BSML_DNSTY IS NOT NULL AND B.BSML_DNSTY > A.STDRVALUE THEN CONCAT('O(',B.BSML_DNSTY,')')
		                          WHEN B.BSML_DNSTY IS NOT NULL AND B.BSML_DNSTY &lt;= A.STDRVALUE THEN 'X'
		                      END AS EX_AT,
		                     A.DTA_DT
		                FROM (
		                      SELECT ANALS_AREA_ID, INTRST_AREA_NM, PREDICT_AL
		                           , START_DT, END_DT
		                           , STDRVALUE, NO
		                           , CASE WHEN DATE_FORMAT(NOW_DT,'%H') BETWEEN '00' AND '05' THEN DATE_FORMAT(CONCAT(DATE_FORMAT(NOW_DT,'%Y%m%d'),'000000'),'%Y-%m-%d %T')
		                                  WHEN DATE_FORMAT(NOW_DT,'%H') BETWEEN '06' AND '11' THEN DATE_FORMAT(CONCAT(DATE_FORMAT(NOW_DT,'%Y%m%d'),'060000'),'%Y-%m-%d %T')
		                                  WHEN DATE_FORMAT(NOW_DT,'%H') BETWEEN '12' AND '17' THEN DATE_FORMAT(CONCAT(DATE_FORMAT(NOW_DT,'%Y%m%d'),'120000'),'%Y-%m-%d %T')
		                                  WHEN DATE_FORMAT(NOW_DT,'%H') BETWEEN '18' AND '23' THEN DATE_FORMAT(CONCAT(DATE_FORMAT(NOW_DT,'%Y%m%d'),'180000'),'%Y-%m-%d %T')
		                              END AS DTA_DT
		                        FROM (
		                              SELECT CASE WHEN B.NO=1 THEN DATE_ADD(NOW_DT,INTERVAL -5 HOUR)
		                                          WHEN B.NO=2 THEN DATE_ADD(NOW_DT,INTERVAL 1 HOUR)
		                                          WHEN B.NO=3 THEN DATE_ADD(NOW_DT,INTERVAL 6 HOUR)
		                                          WHEN B.NO=4 THEN DATE_ADD(NOW_DT,INTERVAL 11 HOUR)
		                                      END AS START_DT
		                                   , CASE WHEN B.NO=1 THEN NOW_DT
		                                          WHEN B.NO=2 THEN DATE_ADD(NOW_DT,INTERVAL 6 HOUR)
		                                          WHEN B.NO=3 THEN DATE_ADD(NOW_DT,INTERVAL 12 HOUR)
		                                          WHEN B.NO=4 THEN DATE_ADD(NOW_DT,INTERVAL 18 HOUR)
		                                      END AS END_DT
		                                   , PARAMETER_3
		                                   , NO, NOW_DT
		                                FROM (
		                                      SELECT DATE_FORMAT(DATE_FORMAT(PARAMETER_1,'%Y%m%d%H0000'),'%Y-%m-%d %T') AS NOW_DT
		                                           , PARAMETER_3
		                                        FROM (
		                                              SELECT SYSDATE() AS PARAMETER_1, -- SYSDATE고정
		                                                     '' AS PARAMETER_2, -- 시 (사용안함)
		                                                     '' AS PARAMETER_3  -- 관심지역코드
		                                             ) A
		                                     ) A
		                                   , ROW_CREAT B
		                               WHERE B.NO &lt;= 4
		                             ) A
		                           , ANALS_AREA_MANAGE B
		                           , SMS_STDRVALUE_MANAGE C
		                       WHERE B.GRID_INTRST_SE_CODE='ANL01002'
		                         AND B.ANALS_AREA_ID=IF(A.PARAMETER_3='',B.ANALS_AREA_ID,A.PARAMETER_3)
		                         AND C.SMS_SE_CODE='COM03002'
		                         AND C.IEM_CODE='S0001'
		                     ) A
		                     LEFT JOIN
		                     LRN_FRCST_AI B
		                     ON (B.ANALS_AREA_ID=A.ANALS_AREA_ID
		                     AND B.DTA_DT BETWEEN A.START_DT AND A.END_DT
		                        )
		             ) A
		       GROUP BY ANALS_AREA_ID
		       ORDER BY NULL
		     ) A
	</select>
	
	<!-- 악취발생예보 - 건수선택 -->
	<select id="getForeCastOccurrenceSel" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT ANALS_AREA_ID, INTRST_AREA_NM
		     , IF(INTRST_AREA_AL IS NULL,'',INTRST_AREA_AL) AS INTRST_AREA_AL
		     , DTA_01, DTA_02, DTA_03, DTA_04
		     , DATE_FORMAT(DTA_DT,'%Y-%m-%d') AS DTA_DE_01
		     , DATE_FORMAT(DATE_ADD(DTA_DT,INTERVAL 6 HOUR),'%Y-%m-%d') AS DTA_DE_02
		     , DATE_FORMAT(DATE_ADD(DTA_DT,INTERVAL 12 HOUR),'%Y-%m-%d') AS DTA_DE_03
		     , DATE_FORMAT(DATE_ADD(DTA_DT,INTERVAL 18 HOUR),'%Y-%m-%d') AS DTA_DE_04
		     , CASE WHEN DATE_FORMAT(DTA_DT,'%H') = '00' THEN '새벽'
		            WHEN DATE_FORMAT(DTA_DT,'%H') = '06' THEN '오전'
		            WHEN DATE_FORMAT(DTA_DT,'%H') = '12' THEN '오후'
		            WHEN DATE_FORMAT(DTA_DT,'%H') = '18' THEN '저녁'
		        END AS DTA_TIME_01
		     , CASE WHEN DATE_FORMAT(DATE_ADD(DTA_DT,INTERVAL 6 HOUR),'%H') = '00' THEN '새벽'
		            WHEN DATE_FORMAT(DATE_ADD(DTA_DT,INTERVAL 6 HOUR),'%H') = '06' THEN '오전'
		            WHEN DATE_FORMAT(DATE_ADD(DTA_DT,INTERVAL 6 HOUR),'%H') = '12' THEN '오후'
		            WHEN DATE_FORMAT(DATE_ADD(DTA_DT,INTERVAL 6 HOUR),'%H') = '18' THEN '저녁'
		        END AS DTA_TIME_02
		     , CASE WHEN DATE_FORMAT(DATE_ADD(DTA_DT,INTERVAL 12 HOUR),'%H') = '00' THEN '새벽'
		            WHEN DATE_FORMAT(DATE_ADD(DTA_DT,INTERVAL 12 HOUR),'%H') = '06' THEN '오전'
		            WHEN DATE_FORMAT(DATE_ADD(DTA_DT,INTERVAL 12 HOUR),'%H') = '12' THEN '오후'
		            WHEN DATE_FORMAT(DATE_ADD(DTA_DT,INTERVAL 12 HOUR),'%H') = '18' THEN '저녁'
		        END AS DTA_TIME_03
		     , CASE WHEN DATE_FORMAT(DATE_ADD(DTA_DT,INTERVAL 18 HOUR),'%H') = '00' THEN '새벽'
		            WHEN DATE_FORMAT(DATE_ADD(DTA_DT,INTERVAL 18 HOUR),'%H') = '06' THEN '오전'
		            WHEN DATE_FORMAT(DATE_ADD(DTA_DT,INTERVAL 18 HOUR),'%H') = '12' THEN '오후'
		            WHEN DATE_FORMAT(DATE_ADD(DTA_DT,INTERVAL 18 HOUR),'%H') = '18' THEN '저녁'
		        END AS DTA_TIME_04
		  FROM (
		        SELECT ANALS_AREA_ID
		             , MAX(INTRST_AREA_NM) AS INTRST_AREA_NM
		             , MAX(PREDICT_AL) AS INTRST_AREA_AL
		             , MAX(IF(NO=1,EX_AT,NULL)) AS DTA_01
		             , MAX(IF(NO=2,EX_AT,NULL)) AS DTA_02
		             , MAX(IF(NO=3,EX_AT,NULL)) AS DTA_03
		             , MAX(IF(NO=4,EX_AT,NULL)) AS DTA_04
		             , MAX(DTA_DT) AS DTA_DT
		          FROM (SELECT A.ANALS_AREA_ID, A.INTRST_AREA_NM, A.NO, A.PREDICT_AL,
		                       A.STDRVALUE, B.BSML_DNSTY,
		                       CASE WHEN B.BSML_DNSTY IS NULL THEN '-'
		                            WHEN B.BSML_DNSTY IS NOT NULL AND B.BSML_DNSTY > A.STDRVALUE THEN CONCAT('O(',B.BSML_DNSTY,')')
		                            WHEN B.BSML_DNSTY IS NOT NULL AND B.BSML_DNSTY &lt;= A.STDRVALUE THEN 'X'
		                        END AS EX_AT,
		                       A.DTA_DT
		                  FROM (
		                        SELECT ANALS_AREA_ID, INTRST_AREA_NM, PREDICT_AL
		                             , START_DT, END_DT
		                             , STDRVALUE, NO
		                             , CASE WHEN DATE_FORMAT(NOW_DT,'%H') BETWEEN '00' AND '05' THEN DATE_FORMAT(CONCAT(DATE_FORMAT(NOW_DT,'%Y%m%d'),'000000'),'%Y-%m-%d %T')
		                                    WHEN DATE_FORMAT(NOW_DT,'%H') BETWEEN '06' AND '11' THEN DATE_FORMAT(CONCAT(DATE_FORMAT(NOW_DT,'%Y%m%d'),'060000'),'%Y-%m-%d %T')
		                                    WHEN DATE_FORMAT(NOW_DT,'%H') BETWEEN '12' AND '17' THEN DATE_FORMAT(CONCAT(DATE_FORMAT(NOW_DT,'%Y%m%d'),'120000'),'%Y-%m-%d %T')
		                                    WHEN DATE_FORMAT(NOW_DT,'%H') BETWEEN '18' AND '23' THEN DATE_FORMAT(CONCAT(DATE_FORMAT(NOW_DT,'%Y%m%d'),'180000'),'%Y-%m-%d %T')
		                                END AS DTA_DT
		                          FROM (
		                                SELECT CASE WHEN B.NO=1 THEN DATE_ADD(NOW_DT,INTERVAL -5 HOUR)
		                                            WHEN B.NO=2 THEN DATE_ADD(NOW_DT,INTERVAL 1 HOUR)
		                                            WHEN B.NO=3 THEN DATE_ADD(NOW_DT,INTERVAL 6 HOUR)
		                                            WHEN B.NO=4 THEN DATE_ADD(NOW_DT,INTERVAL 11 HOUR)
		                                        END AS START_DT
		                                     , CASE WHEN B.NO=1 THEN NOW_DT
		                                            WHEN B.NO=2 THEN DATE_ADD(NOW_DT,INTERVAL 6 HOUR)
		                                            WHEN B.NO=3 THEN DATE_ADD(NOW_DT,INTERVAL 12 HOUR)
		                                            WHEN B.NO=4 THEN DATE_ADD(NOW_DT,INTERVAL 18 HOUR)
		                                        END AS END_DT
		                                     , PARAMETER_3
		                                     , NO, NOW_DT
		                                  FROM (
		                                        SELECT DATE_FORMAT(DATE_FORMAT(PARAMETER_1,'%Y%m%d%H0000'),'%Y-%m-%d %T') AS NOW_DT
		                                             , PARAMETER_3
		                                          FROM (
		                                                SELECT SYSDATE() AS PARAMETER_1, -- SYSDATE고정
		                                                       '' AS PARAMETER_2, -- 시 (사용안함)
		                                                       '' AS PARAMETER_3  -- 관심지역코드
		                                               ) A
		                                       ) A
		                                     , ROW_CREAT B
		                                 WHERE B.NO &lt;= 4
		                               ) A
		                             , ANALS_AREA_MANAGE B
		                             , SMS_STDRVALUE_MANAGE C
		                         WHERE B.GRID_INTRST_SE_CODE='ANL01002'
		                           AND B.ANALS_AREA_ID=IF(A.PARAMETER_3='',B.ANALS_AREA_ID,A.PARAMETER_3)
		                           AND C.SMS_SE_CODE='COM03002'
		                           AND C.IEM_CODE='S0001'
		                       ) A
		                       LEFT JOIN
		                       LRN_FRCST_AI B
		                       ON (B.ANALS_AREA_ID=A.ANALS_AREA_ID
		                       AND B.DTA_DT=A.DTA_DT
		                          )
		               ) A
		         GROUP BY ANALS_AREA_ID
		         ORDER BY NULL
		       ) A
		  <if test="gubun == 1">
		  WHERE DTA_01 LIKE 'O%'  -- 필요에 따라(00-05)
		  </if>
		  <if test="gubun == 2">
		  WHERE DTA_02 LIKE 'O%'  -- 필요에 따라(06-11)
		  </if>
		  <if test="gubun == 3">
		  WHERE DTA_03 LIKE 'O%'  -- 필요에 따라(12-17)
		  </if>
		  <if test="gubun == 4">
		  WHERE DTA_04 LIKE 'O%'  -- 필요에 따라(18-23)
		  </if>
		  ORDER BY INTRST_AREA_NM, ANALS_AREA_ID
	</select>
	
	<!-- 저감장치가동현황 -->
	<select id="getReductionFacil" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT BPLC_ID,
		       MAX(BSML_TRGNPT_NM) AS BSML_TRGNPT_NM,
		       MAX(REDUC_EQP_NM) AS REDUC_EQP_NM,
		       MAX(B.CODE_NM) AS REDUC_EQP_TY_NM,
		       NVL(DATE_FORMAT(DATE_ADD(MAX(START_DT),INTERVAL SUM(TIMESTAMPDIFF(SECOND,ON_DT,OFF_DT)) SECOND),'%H시간 %i분'),'미가동') AS ON_TIME,
		       REDUC_EQP_NO,
		       DATE_FORMAT(MAX(START_DT),'%Y-%m-%d') AS PARAMETER_1,
		       COUNT(1)OVER() AS DTA_CO
		  FROM (
		        SELECT BPLC_ID, REDUC_EQP_NO,
		               CTRL_CN_CODE,
		               CASE WHEN NO_DTA_AT='Y' AND CTRL_CN_CODE='COM08001' THEN START_DT
		                    WHEN NO_DTA_AT IS NULL AND DTA_FIRST_RN=1 AND CTRL_CN_CODE='COM08002' THEN START_DT
		                    WHEN NO_DTA_AT IS NULL AND DTA_FIRST_RN &lt;&gt; 1 AND CTRL_CN_CODE='COM08002' THEN LAG(EQP_CTRL_DT)OVER(PARTITION BY BPLC_ID, REDUC_EQP_NO ORDER BY EQP_CTRL_DT)
		                    WHEN NO_DTA_AT IS NULL AND DTA_LAST_RN=1 AND CTRL_CN_CODE='COM08001' THEN EQP_CTRL_DT
		                END AS ON_DT,
		               CASE WHEN NO_DTA_AT='Y' AND CTRL_CN_CODE='COM08001' THEN END_DT
		                    WHEN NO_DTA_AT IS NULL AND CTRL_CN_CODE='COM08002' THEN EQP_CTRL_DT
		                    WHEN NO_DTA_AT IS NULL AND DTA_LAST_RN=1 AND CTRL_CN_CODE='COM08001' THEN END_DT
		                END AS OFF_DT,
		               BSML_TRGNPT_NM, REDUC_EQP_NM, REDUC_EQP_TY_CODE, DTA_DE,
		               START_DT
		          FROM (
		                SELECT BPLC_ID, REDUC_EQP_NO,
		                       NVL(CTRL_CN_CODE,(SELECT CTRL_CN_CODE
		                                           FROM BSML_REDUC_EQP_CTRL_HIST  B
		                                          WHERE B.BPLC_ID=A.BPLC_ID
		                                            AND B.REDUC_EQP_NO=A.REDUC_EQP_NO
		                                            AND B.EQP_CTRL_DT=A.EQP_CTRL_DT
		                                        )
		                          ) AS CTRL_CN_CODE,
		                       IF(CTRL_CN_CODE IS NULL,'Y',NULL) AS NO_DTA_AT,
		                       EQP_CTRL_DT,
		                       ROW_NUMBER()OVER(PARTITION BY BPLC_ID, REDUC_EQP_NO ORDER BY EQP_CTRL_DT) AS DTA_FIRST_RN,
		                       ROW_NUMBER()OVER(PARTITION BY BPLC_ID, REDUC_EQP_NO ORDER BY EQP_CTRL_DT DESC) AS DTA_LAST_RN,
		                       BSML_TRGNPT_NM, REDUC_EQP_NM, REDUC_EQP_TY_CODE, DTA_DE,
		                       START_DT, END_DT, LAG_CODE
		                  FROM (
		                        SELECT A.*,
		                               B.CTRL_CN_CODE,
		                               NVL(B.EQP_CTRL_DT,(SELECT MAX(EQP_CTRL_DT)
		                                                    FROM BSML_REDUC_EQP_CTRL_HIST C
		                                                   WHERE C.BPLC_ID=A.BPLC_ID
		                                                     AND C.REDUC_EQP_NO=A.REDUC_EQP_NO
		                                                     AND C.EQP_CTRL_DT &lt;= A.START_DT
		                                                 )
		                                  ) AS EQP_CTRL_DT,               
		                               LAG(B.CTRL_CN_CODE)OVER(PARTITION BY B.BPLC_ID, B.REDUC_EQP_NO ORDER BY B.EQP_CTRL_DT) AS LAG_CODE
		                          FROM (
		                                SELECT B.BPLC_ID, B.BSML_TRGNPT_NM,
		                                       C.REDUC_EQP_NO, C.REDUC_EQP_NM, C.REDUC_EQP_TY_CODE,
		                                       PARAMETER_1 AS DTA_DE,
		                                       DATE_FORMAT(A.PARAMETER_1,'%Y-%m-%d %T') AS START_DT,
		                                       DATE_FORMAT(CONCAT(A.PARAMETER_1,'235959'),'%Y-%m-%d %T') AS END_DT
		                                  FROM (SELECT #{nDate} AS PARAMETER_1, -- 조회일
		                                               '' AS PARAMETER_2, -- 돈사ID
		                                               '' AS PARAMETER_3, -- 저감설비NO
		                                               '' AS PARAMETER_4  -- 설비유형
		                                       ) A,
		                                       BPLC_INFO B,
		                                       BSML_REDUC_EQP_INFO C
		                                 WHERE B.BSML_TRGNPT_SE_CODE='BSL01002'
		                                   AND B.BPLC_ID=IF(A.PARAMETER_2='',B.BPLC_ID,A.PARAMETER_2)
		                                   AND C.BPLC_ID=B.BPLC_ID
		                                   AND C.REDUC_EQP_NO=IF(A.PARAMETER_3='',C.REDUC_EQP_NO,A.PARAMETER_3)
		                                   AND C.REDUC_EQP_TY_CODE=IF(A.PARAMETER_4='',C.REDUC_EQP_TY_CODE,A.PARAMETER_4)
		                               ) A
		                               LEFT JOIN
		                               BSML_REDUC_EQP_CTRL_HIST B
		                               ON (B.BPLC_ID=A.BPLC_ID
		                               AND B.REDUC_EQP_NO=A.REDUC_EQP_NO
		                               AND B.EQP_CTRL_DT BETWEEN A.START_DT AND A.END_DT
		                               AND B.CTRL_RESULT_CODE='COM05000'
		                                  )
		                          ) A
		                 WHERE LAG_CODE IS NULL
		                    OR CTRL_CN_CODE &lt;&gt; LAG_CODE
		               ) A
		       ) A,
		       COM_CODE B
		 WHERE B.CODE=A.REDUC_EQP_TY_CODE
		 GROUP BY BPLC_ID, REDUC_EQP_NO
		 ORDER BY BPLC_ID, REDUC_EQP_NO
	</select>
	
	<!-- 관심 지역 목록 -->
	<select id="getAnalsAreaList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	SELECT INTRST_AREA_NM, ANALS_AREA_ID
	  FROM ANALS_AREA_MANAGE
	 WHERE GRID_INTRST_SE_CODE = 'ANL01002'
	 ORDER BY INTRST_AREA_NM, ANALS_AREA_ID	
	</select>
	
	<!-- 악취 발생 예보 현황 목록 -->
    <select id="getOccurrenceForecastList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
     <![CDATA[
			 	SELECT ANALS_AREA_ID
				     , MAX(INTRST_AREA_NM) AS INTRST_AREA_NM
				     , MAX(PREDICT_AL) AS INTRST_AREA_AL
				     , MAX(IF(NO=1,EX_AT,NULL)) AS DTA_01
				     , MAX(IF(NO=2,EX_AT,NULL)) AS DTA_02
				     , MAX(IF(NO=3,EX_AT,NULL)) AS DTA_03
				     , MAX(IF(NO=4,EX_AT,NULL)) AS DTA_04
				     , GRID_AREA_ID
				     , COUNT(1)OVER() AS DTA_CO
				  FROM (SELECT A.ANALS_AREA_ID, A.INTRST_AREA_NM, A.NO, A.PREDICT_AL,
				               A.STDRVALUE, B.BSML_DNSTY, A.GRID_AREA_ID,
				               CASE WHEN B.BSML_DNSTY IS NULL THEN 'N/A'
				                    WHEN B.BSML_DNSTY IS NOT NULL AND B.BSML_DNSTY > A.STDRVALUE THEN CONCAT('O(',B.BSML_DNSTY,')')
				                    WHEN B.BSML_DNSTY IS NOT NULL AND B.BSML_DNSTY <= A.STDRVALUE THEN 'X'
				                END AS EX_AT
				          FROM (
				                SELECT ANALS_AREA_ID, INTRST_AREA_NM, PREDICT_AL
				                     , CASE WHEN C.NO=1 THEN DATE_FORMAT(CONCAT(PARAMETER_1,'000000'),'%Y-%m-%d %T')
				                            WHEN C.NO=2 THEN DATE_FORMAT(CONCAT(PARAMETER_1,'060000'),'%Y-%m-%d %T')
				                            WHEN C.NO=3 THEN DATE_FORMAT(CONCAT(PARAMETER_1,'120000'),'%Y-%m-%d %T')
				                            WHEN C.NO=4 THEN DATE_FORMAT(CONCAT(PARAMETER_1,'180000'),'%Y-%m-%d %T')
				                        END AS DTA_DT
				                     , STDRVALUE, NO, B.GRID_AREA_ID
				                  FROM (
				                        SELECT IFNULL(REPLACE(#{nDate}, '-', ''), CURDATE()+0) AS PARAMETER_1, -- 예보일
					                              '' AS PARAMETER_2, -- 시
					                              #{area} AS PARAMETER_3  -- 관심지역코드
				                       ) A,
				                       ANALS_AREA_MANAGE B,
				                       ROW_CREAT C,
				                       SMS_STDRVALUE_MANAGE D
				                 WHERE B.GRID_INTRST_SE_CODE='ANL01002'
				                   AND B.ANALS_AREA_ID=IF(A.PARAMETER_3='',B.ANALS_AREA_ID,A.PARAMETER_3)
				                   AND C.NO <= 4
				                   AND D.SMS_SE_CODE='COM03002'
				                   AND D.IEM_CODE='S0001'
				               ) A
				               LEFT JOIN
				               LRN_FRCST_AI B
				               ON (B.ANALS_AREA_ID=A.ANALS_AREA_ID
				               AND B.DTA_DT=A.DTA_DT
				                  )
				       ) A
				 GROUP BY ANALS_AREA_ID
				 ORDER BY INTRST_AREA_NM, ANALS_AREA_ID
			 ]]>
    </select>
	
	<!-- 악취 발생 예보 현황 목록 -->
    <select id="getOdorForecastXY" parameterType="java.util.HashMap" resultType="java.util.HashMap">
    	SELECT ST_ASTEXT(SHAPE) AS "shape" FROM shp_windfild WHERE ANALS_AREA = #{gridId}
    </select>
    
    
    <!-- 악취 발생 예보 현황 목록 -->
    <select id="getPlotLine" parameterType="java.util.HashMap" resultType="java.util.HashMap">
    	SELECT TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0002' THEN STDRVALUE END),3) AS 'H2S',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0004' THEN STDRVALUE END),3) AS 'VOCS',
			   TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0003' THEN STDRVALUE END),3) AS 'NH3',
               (SELECT TRUNCATE(SUM(CASE WHEN A.IEM_CODE='S0001' THEN STDRVALUE END),3) AS 'OU'
          FROM SMS_STDRVALUE_MANAGE A
         WHERE SMS_SE_CODE = 'COM03001') AS 'OU'
  		  FROM SMS_STDRVALUE_MANAGE A
  		 WHERE SMS_SE_CODE = 'COM03003'
    </select>
    
    
    <!-- SMS insert -->
	<insert id="insertSMS" parameterType="Map">
		INSERT INTO NURI_MSG_DATA (CUR_STATE, REQ_DATE, CALL_TO, CALL_FROM, SMS_TXT, MSG_TYPE)
		VALUES(0, NOW(), #{toPhone}, #{fromPhone}, #{contents}, 4);
	</insert>

	<!-- MMS content insert -->
	<insert id="insertMMSCont" parameterType="Map">
		INSERT INTO NURI_MMS_CONTENTS_INFO (FILE_CNT, MMS_SUBJECT, MMS_BODY, SERVICE_DEP1 )
		VALUES (0, '', #{contents}, 'ALL')
	</insert>
	
	<!-- MMS insert -->
	<insert id="insertMMS" parameterType="Map">
		INSERT INTO NURI_MSG_DATA (CUR_STATE, REQ_DATE, CALL_TO, CALL_FROM, MSG_TYPE, CONT_SEQ)
		VALUES(0, NOW(), #{toPhone}, #{fromPhone},  6, (select max(cont_seq) from nuri_mms_contents_info))
	</insert>
</mapper>