<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ce.smell.mapper.MapMapper">

	<select id="getCMAQ9KM" resultType="com.ce.smell.model.MapVO">
		SELECT OGR_FID, 
		       INDEXID, 
		       NVL(FLAG, 0) AS FLAG 
		  FROM CMAQ_9KM_WGS84_2
	</select>

	<update id="putFlag" parameterType="java.util.HashMap">
		UPDATE CMAQ_9KM_WGS84_2 SET FLAG = #{flag} WHERE INDEXID = #{indexId}
	</update>
	
	<select id="complaintStatusGrid" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT CVPL_NO,
	           DATE_FORMAT(CVPL_DT,'%Y년 %m월 %d일 %h시') AS CVPL_DT,
			   CPTTR,
			   CPTTR_CTTPC,
			   CVPL_LC,
			   CVPL_CN,
			   DATE_FORMAT(REGIST_DT,'%Y년 %m월 %d일 %h시') AS REGIST_DT,
			   REGISTER_ID,
			   CHANGE_DT,
			   CHANGER_ID,
			   LEGALDONG_CODE
  		  FROM CVPL_MANAGE
  		 WHERE DATE_FORMAT(CVPL_DT,'%Y%m%d') <![CDATA[>=]]> #{startDate}
     	   AND DATE_FORMAT(CVPL_DT,'%Y%m%d') <![CDATA[<=]]> #{endDate}
     	   <if test="branchName != null">
    			AND CVPL_CN LIKE CONCAT('%', #{branchName}, '%')
  			</if>	
     	   AND LEGALDONG_CODE LIKE CONCAT('%', #{town}, '%')
	</select>
	
	<select id="portableMeasurementGrid" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE) AS CODE,
			   B.OPR_STTUS_CODE,
			   LA,
	   		   LO,
	   		   CONCAT( CASE WHEN A.SPOT_CODE='0005' THEN '1호 ' WHEN A.SPOT_CODE='0006' THEN '2호 ' END,DATE_FORMAT(MESURE_DT,'%Y년%m월%d일')) AS LABEL,
	   		   DATE_FORMAT(MESURE_DT,'%Y년 %m월 %d일 %H시 %i분') AS MESURE_DT,
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='1' THEN MESURE_DNSTY END),3) AS 'VOCS',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='2' THEN MESURE_DNSTY END),3) AS 'CCNT',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='3' THEN MESURE_DNSTY END),3) AS 'NH3',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='4' THEN MESURE_DNSTY END),3) AS 'ERCRT',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='5' THEN MESURE_DNSTY END),3) AS 'H2S',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='6' THEN MESURE_DNSTY END),3) AS 'ARCSR',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='7' THEN MESURE_DNSTY END),3) AS 'OU',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='8' THEN MESURE_DNSTY END),3) AS 'SOLRAD',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='9' THEN MESURE_DNSTY END),3) AS 'HD',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='10' THEN MESURE_DNSTY END),3) AS 'TMPRT',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='11' THEN MESURE_DNSTY END),3) AS 'WD',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='12' THEN MESURE_DNSTY END),3) AS 'WS',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='13' THEN MESURE_DNSTY END),3) AS 'NO2',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='14' THEN MESURE_DNSTY END),3) AS 'SO2',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='15' THEN MESURE_DNSTY END),3) AS 'PM10',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='16' THEN MESURE_DNSTY END),3) AS 'PM2_5',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='17' THEN MESURE_DNSTY END),3) AS 'CFC',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='18' THEN MESURE_DNSTY END),3) AS 'CH3SH',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='19' THEN MESURE_DNSTY END),3) AS 'TMA',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='20' THEN MESURE_DNSTY END),3) AS 'ETHANOL',
			   DATE_FORMAT(MESURE_DT,'%Y%m%d%H%i') AS DATE
  		  FROM IOT_SENSOR_MESURE_INFO A,
	   		   IOT_SENSOR_SPCS_INFO B,
	     	   IOT_MESURE_IEM_MANAGE C
 		 WHERE A.SPOT_CODE IN (#{radio})
   		   AND CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE,A.SENSOR_SPCS_NO) = CONCAT(B.LEGALDONG_CODE,B.SPOT_CODE,B.SENSOR_SPCS_NO)
   		   AND C.IEM_CODE = B.IEM_CODE
   		   AND A.LEGALDONG_CODE LIKE CONCAT('%', #{town}, '%')
   		   AND DATE_FORMAT(MESURE_DT,'%Y%m%d%H') <![CDATA[>=]]> CONCAT(#{startDate},#{startTime})
     	   AND DATE_FORMAT(MESURE_DT,'%Y%m%d%H') <![CDATA[<=]]> CONCAT(#{endDate},#{endTime})
     	   <if test="branchName != null">
    			AND B.OPR_STTUS_CODE LIKE CONCAT('%', #{branchName}, '%')
  			</if>
	  GROUP BY CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE),OPR_STTUS_CODE,MESURE_DNSTY, LA,LO,MESURE_DT
	</select>
	
	<select id="fixedMeasurementGrid" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE) AS CODE,
			   C.OPR_STTUS_CODE,
			   B.LA,
			   B.LO,
			   DATE_FORMAT(MESURE_DT,'%Y%m%d%H%i') AS DATE,
			   DATE_FORMAT(MESURE_DT,'%Y년 %m월 %d일 %H시 %i분') AS MESURE_DT,
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='1' THEN MESURE_DNSTY END),3) AS 'VOCS',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='2' THEN MESURE_DNSTY END),3) AS 'CCNT',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='3' THEN MESURE_DNSTY END),3) AS 'NH3',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='4' THEN MESURE_DNSTY END),3) AS 'ERCRT',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='5' THEN MESURE_DNSTY END),3) AS 'H2S',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='6' THEN MESURE_DNSTY END),3) AS 'ARCSR',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='7' THEN MESURE_DNSTY END),3) AS 'OU',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='8' THEN MESURE_DNSTY END),3) AS 'SOLRAD',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='9' THEN MESURE_DNSTY END),3) AS 'HD',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='10' THEN MESURE_DNSTY END),3) AS 'TMPRT',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='11' THEN MESURE_DNSTY END),3) AS 'WD',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='12' THEN MESURE_DNSTY END),3) AS 'WS',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='13' THEN MESURE_DNSTY END),3) AS 'NO2',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='14' THEN MESURE_DNSTY END),3) AS 'SO2',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='15' THEN MESURE_DNSTY END),3) AS 'PM10',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='16' THEN MESURE_DNSTY END),3) AS 'PM2_5',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='17' THEN MESURE_DNSTY END),3) AS 'CFC',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='18' THEN MESURE_DNSTY END),3) AS 'CH3SH',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='19' THEN MESURE_DNSTY END),3) AS 'TMA',
			   TRUNCATE(SUM(CASE WHEN A.SENSOR_SPCS_NO='20' THEN MESURE_DNSTY END),3) AS 'ETHANOL' 
  		  FROM IOT_SENSOR_MESURE_INFO A,
	   		   IOT_SENSOR_INFO B,
	   		   IOT_SENSOR_SPCS_INFO C,
	   		   IOT_MESURE_IEM_MANAGE D
		 WHERE A.SPOT_CODE IN ('0001',0002)
  		   AND CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE) = CONCAT(B.LEGALDONG_CODE,B.SPOT_CODE)
  		   AND CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE,A.SENSOR_SPCS_NO) = CONCAT(C.LEGALDONG_CODE,C.SPOT_CODE,C.SENSOR_SPCS_NO)
  		   AND CONCAT(B.LEGALDONG_CODE,B.SPOT_CODE) = CONCAT(C.LEGALDONG_CODE,C.SPOT_CODE)
  		   AND D.IEM_CODE = C.IEM_CODE
  		   AND A.LEGALDONG_CODE LIKE CONCAT('%', #{town}, '%')
   		   AND DATE_FORMAT(MESURE_DT,'%Y%m%d%H%i') = CONCAT(#{startDate},#{startTime},#{startMinute})
     	    <if test="branchName != null">
    			AND B.OPR_STTUS_CODE LIKE CONCAT('%', #{branchName}, '%')
  			</if>
  	  GROUP BY CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE),OPR_STTUS_CODE,MESURE_DNSTY, LA,LO,MESURE_DT
	</select>
	
	<select id="portableMeasurementClick" parameterType="String" resultType="java.util.HashMap">
	   	SELECT LO,LA,DATE_FORMAT(A.MESURE_DT,'%Y년 %m월 %d일 %H시 %i분') AS MESURE_DT,CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE) AS SENSOR_ID,OPR_STTUS_CODE
  		   FROM IOT_SENSOR_MESURE_INFO A,
		        IOT_SENSOR_SPCS_INFO B
		  WHERE CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE,A.SENSOR_SPCS_NO) = CONCAT(B.LEGALDONG_CODE,B.SPOT_CODE,B.SENSOR_SPCS_NO)
		    AND CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE) = #{CODE}
  			AND DATE_FORMAT(A.MESURE_DT,'%Y%m%d%H%i') = #{DATE}
       GROUP BY LO,LA,MESURE_DT,SENSOR_ID,OPR_STTUS_CODE
	</select>
	
	<select id="fixedMeasurementClick" parameterType="String" resultType="java.util.HashMap">
	   SELECT B.LO,B.LA, CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE) AS SENSOR_ID, OPR_STTUS_CODE,DATE_FORMAT(MESURE_DT,'%Y년 %m월 %d일 %H시 %i분') AS MESURE_DT
  		   FROM IOT_SENSOR_MESURE_INFO A,
		        IOT_SENSOR_INFO B
		  WHERE CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE) = CONCAT(B.LEGALDONG_CODE,B.SPOT_CODE)
		    AND CONCAT(A.LEGALDONG_CODE,A.SPOT_CODE) = #{CODE}
  			AND DATE_FORMAT(MESURE_DT,'%Y%m%d%H%i') = #{DATE}
	   GROUP BY LO,LA,SENSOR_ID,OPR_STTUS_CODE,MESURE_DT
	</select>
	
	<select id="getCity" parameterType="String" resultType="java.util.HashMap">
		 SELECT SIGNGU_NM AS NAME, 
		        SUBSTR(LEGALDONG_CODE,1,5) AS CODE
    	   FROM LEGALDONG_CODE
   		  WHERE LEGALDONG_CODE LIKE '4311%' 
     		AND EMD_NM != ''
	   GROUP BY SIGNGU_NM
       ORDER BY SIGNGU_NM
	</select>
	
	<select id="getTown" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		   SELECT EMD_NM AS NAME, SUBSTR(LEGALDONG_CODE,1,8) AS CODE
    		 FROM LEGALDONG_CODE
   			WHERE EMD_NM != ''
	 		  AND LEGALDONG_CODE LIKE CONCAT(#{code},'%')
		 GROUP BY EMD_NM
		 ORDER BY EMD_NM
	</select>
	
	<select id="getPOISelect" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	SELECT LCLASDC,
	   	   MLSFCDC,
	   	   SCLASDC
     FROM ( SELECT DISTINCT MLSFCDC,LCLASDC,SCLASDC
  			  FROM shp_poi A
 ORDER BY LCLASDC,MLSFCDC) AA
	</select>
	<select id="getPOISearch" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	  SELECT POIID,
		 	 LCLASDC,
		 	 MLSFCDC,
		 	 SCLASDC,
		 	 FMYNM,
		 	 ETCADRES
    	FROM shp_poi
   	   WHERE LCLASDC = #{poiSelect01}
     	 AND MLSFCDC = #{poiSelect02}
	 	 AND SCLASDC = #{poiSelect03}
	 	 <if test="poiText != null">
    			AND FMYNM LIKE CONCAT('%',#{poiText},'%')
  		</if>
	 	 
	</select>
	<select id="odorOriginGrid" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	  SELECT BPLC_ID,BSML_TRGNPT_SE_CODE,CMPNY_NM,'데이터 나오면 JOIN' AS LEGALDONG_CODE,'데이터 나오면 JOIN' AS LEGALDONG_ETC,TELNO,INDUTY,'shape 나오면 join' as X,'shape 나오면 join' as Y 
  		FROM BPLC_INFO
 	   WHERE LEGALDONG_CODE LIKE  CONCAT(#{town}, '%')
 	   <if test="branchName != null">
   	     AND BSML_TRGNPT_NM LIKE CONCAT('%', #{branchName}, '%')
   	   </if>
	</select>
</mapper>